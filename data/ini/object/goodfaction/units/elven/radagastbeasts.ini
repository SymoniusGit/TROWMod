;-----------------------------------------------------------------------------
;
;	Radagast Wolf.ini
;
;-----------------------------------------------------------------------------

Object ElvenRadagastWolf
	; *** ART Parameters ***
    
	; This is required for garrisoned objects - please put in all objects.
    ; SelectPortrait for Heros is portrait behind skill buttons. HP = HeroPortrait.
	SelectPortrait = HPRadagast

    ; ButtonImage for Heros is button image on Hero Select UI to select hero. HI = HeroIcon or HeroImage.
	ButtonImage = HIRadagast


	Draw = W3DHordeModelDraw ModuleTag_01

		OkToChangeModelColor = Yes
		  
		StaticModelLODMode = Yes

		DefaultModelConditionState
			Model				= KUDireWolf_SKN
			Skeleton			= KUDireWolf_SKL
		End
	
        	RandomTexture = CURdgWolf.tga 0 KUDireWolf.tga

		; -------------- STUNNED ANIMS ----------------

		AnimationState				= SPECIAL_WEAPON_ONE
			Animation			= Grabbed
				AnimationName		= KUDireWolf_TNTA
				AnimationMode		= ONCE
			End
		End
		AnimationState				= PASSENGER
			Animation			= Grabbed
				AnimationName		= KUDireWolf_GBDA
				AnimationMode		= LOOP
			End
		End
	
		AnimationState				= FREEFALL
			Animation			= freefall
				AnimationName		= KUDireWolf_FLYA
				AnimationMode		= LOOP
				AnimationBlendTime	= 10
			End
		End
		
		AnimationState				=	DYING BURNINGDEATH
			Animation
				AnimationName		=	KUDireWolf_DIEA
				AnimationMode		=	ONCE
				AnimationBlendTime	=	10
			End
		End

		AnimationState				=	DYING SPLATTED
			Animation			=	splatted
				AnimationName		=	KUDireWolf_LNDA
				AnimationMode		=	ONCE
			End
		End
		
		AnimationState				=	STUNNED_FLAILING 
			Animation			=	JustDie
				AnimationName       	=	KUDireWolf_FLYA
				AnimationMode       	=	LOOP
			End
		End

		AnimationState				=	DYING
			Animation			
				AnimationName		=	KUDireWolf_DIEA
				AnimationMode		=	ONCE
			End
			Animation			
				AnimationName		=	KUDireWolf_DIEB
				AnimationMode		=	ONCE
			End
		End		

		AnimationState				=	BURNINGDEATH
			Animation
				AnimationName       	=	KUDireWolf_MFDA
				AnimationMode       	=	LOOP
				Distance		=	50
			End
		End

	AnimationState			= STUNNED_FLAILING
		Animation
			AnimationName   = KUDireWolf_FLYA
			AnimationMode   = LOOP
			AnimationSpeedFactorRange	= 0.4 0.6
		End
	End


		AnimationState				=	STUNNED 
			Animation			=	Land
				AnimationName       	=	KUDireWolf_LNDA
				AnimationMode       	=	ONCE
			End
		End

		AnimationState				=	STUNNED_STANDING_UP
			Animation			=	StandUp
				AnimationName       	=	KUDireWolf_GTPA
				AnimationMode       	=	ONCE
			End
		End
		
		; -------------- MOVING ANIMS ---------------
		AnimationState				=	TURN_LEFT_HIGH_SPEED
			Animation			=	MTurnLeft
				AnimationName		=	KUDireWolf_TNL1
				AnimationMode		=	LOOP
			End
		End

		AnimationState				=	TURN_RIGHT_HIGH_SPEED
			Animation			=	MTurnRight
				AnimationName		=	KUDireWolf_TNR1
				AnimationMode		=	LOOP
			End
		End
		
		AnimationState				=	TURN_LEFT  
			Animation			=	TurnRight
				AnimationName		=	KUDireWolf_TRNL
				AnimationMode		=	LOOP
				AnimationSpeedFactorRange = 	2.0 2.0
			End
		End

		AnimationState				=	TURN_RIGHT 
			Animation			=	TurnRight
				AnimationName		=	KUDireWolf_TRNR
				AnimationMode		=	LOOP
				AnimationSpeedFactorRange = 	2.0 2.0
			End
		End

		AnimationState				=	MOVING ACCELERATE 
			Animation			=	Accelerate
				AnimationName		=	KUDireWolf_ACCL
				AnimationMode		=	ONCE
			End
            ParticleSysBone				= 	None GenericSiegeTrailDust
		End
	
		AnimationState				=	MOVING DECELERATE
			Animation			=	Decelerate
				AnimationName		=	KUDireWolf_DECL
				AnimationMode		=	ONCE
			End
            ;ParticleSysBone				= 	None GenericSiegeTrailDust
		End
		
		AnimationState				=	MOVING BACKING_UP
			Animation			=	BackingUp
				AnimationName		=	KUDireWolf_BAKA
				AnimationMode		=	LOOP
			End
		End
		
		AnimationState				=	MOVING
			ShareAnimation			=	Yes
			Animation			=	RunA
				AnimationName		=	KUDireWolf_RUNA
				AnimationMode		=	LOOP
			End
			;ParticleSysBone		=	None CalvaryDustTrails  
			Flags               = RANDOMSTART
		End
		
		; ----------- ATTACKING ANIMS --------------		
		AnimationState				=	BETWEEN_FIRING_SHOTS_A
			Animation			=	BetweenFiringShots
				AnimationName		=	KUDireWolf_IDLA
				AnimationMode		=	ONCE
				AnimationBlendTime	=   	10
			End
		End

		AnimationState				=	FIRING_OR_PREATTACK_A
			Animation			
				AnimationName		=	KUDireWolf_ATKB
				AnimationMode		=	LOOP
;				UseWeaponTiming		=	Yes
				AnimationBlendTime  	=	10
			End
		End
		
		AnimationState				=	ATTACKING
			Animation			
				AnimationName		=	KUDireWolf_ATKA
				AnimationMode		=	LOOP
				AnimationBlendTime	=   	10
			End
			Animation			
				AnimationName		=	KUDireWolf_ATKB
				AnimationMode		=	LOOP
				UseWeaponTiming		=	Yes
				AnimationBlendTime  	=	10
			End
		End

		; ----------- WAR CHANT ANIMS -------------
		AnimationState = WAR_CHANT
			Animation = Chant
				AnimationName = KUDireWolf_TNTA
				AnimationMode = LOOP
			End
		End

		; ----------- EMOTION ANIMS ---------------
		AnimationState				= EMOTION_TAUNTING
			Animation			= TNTA
				AnimationName		= KUDireWolf_TNTA
				AnimationMode		= LOOP
			End
		End
		
		AnimationState				= EMOTION_CELEBRATING
			Animation                   	= CHRA
				AnimationName		= KUDireWolf_TNTA
				AnimationMode		= LOOP
			End
		End
		
		; ----------- IDLE ANIMS ---------------
		AnimationState				= EMOTION_ALERT
			StateName			= STATE_Ready 
			Animation			= ALERT
				AnimationName		= KUDireWolf_IDLA
				AnimationMode		= ONCE
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "Selected" then CurDrawableSetTransitionAnimState("Selected_to_Ready") end
			EndScript	
		End
		
		; ----------- SELECTED ANIMS --------------
		AnimationState				= SELECTED
			SimilarRestart			= Yes
			Animation			= AtAttention
				AnimationName		= KUDireWolf_ATNB
				AnimationMode		= LOOP
			End
			StateName			= Selected
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "Idle" then CurDrawableSetTransitionAnimState("Idle_to_Selected") end
				if Prev == "STATE_Ready" then CurDrawableSetTransitionAnimState("Ready_to_Selected") end
			EndScript
		End

		IdleAnimationState
			StateName				= STATE_Idle
			Animation				= IDLB
				AnimationName       = KUDireWolf_IDLB
				AnimationMode       = ONCE
				AnimationPriority   = 20
				AnimationSpeedFactorRange = 0.9 1.1
				AnimationBlendTime	= 15
			End
			Animation				= IDLC
				AnimationName       = KUDireWolf_IDLC
				AnimationMode       = ONCE
				AnimationPriority   = 5
				AnimationSpeedFactorRange = 0.9 1.1
				AnimationBlendTime	= 15
			End
			Animation				= IDLD
				AnimationName       = KUDireWolf_IDLD
				AnimationMode       = ONCE
				AnimationPriority   = 1
				AnimationSpeedFactorRange = 0.9 1.1
				AnimationBlendTime	= 15
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "Selected" then CurDrawableSetTransitionAnimState("Selected_to_Idle") end
			EndScript
		End

		AnimationState        = PACKING_TYPE_1
			Animation           = SPCA
				AnimationName     = KUDireWolf_SPCA
				AnimationMode     = ONCE
			End
		End

		;------------ TRANSITION ANIMS ----------------
		TransitionState       = Selected_to_Idle
			Animation           		= ATNE
				AnimationName		=	KUDireWolf_ATNC
				AnimationMode		=	ONCE
				AnimationSpeedFactorRange = 0.7 1.3
			End
		End
		
		TransitionState       = Idle_to_Selected
			Animation           		= ATND
				AnimationName     	= KUDireWolf_ATNA
				AnimationMode   	=	ONCE
				AnimationSpeedFactorRange = 0.7 1.3
			End
		End

	End
	
	Draw = W3DScriptedModelDraw DustEffects
	    DefaultModelConditionState
	      Model = None
	    End
	    IdleAnimationState
	    End
	    AnimationState = MOVING WADING
			ParticleSysBone = None FootstepSlash
	    End
	    AnimationState = MOVING ACCELERATE
			ParticleSysBone = None GenericSiegeTrailDust
	    End
	    ;AnimationState = MOVING DECELERATE
		;	ParticleSysBone = None GenericSiegeTrailDust
	    ;End
	    AnimationState = MOVING
	    End
	End

    #include "..\..\..\includes\StunDrawModuleMedium.inc"

	; ***DESIGN parameters ***
	Side = Elves
	EditorSorting = UNIT
	ThreatLevel = GANDALF_THREAT_LEVEL
	ThingClass = CHARACTER_UNIT
  	;BuildCost         = 2500				
  	;BuildTime         = BOROMIR_BUILDTIME	
	ShockwaveResistance = SHOCKWAVE_RESISTANCE_STRONG	
	;//DisplayMeleeDamage = BOROMIR_DAMAGE
	

	#include "..\..\..\includes\CaptureBuilding.inc"

	WeaponSet
		Conditions 	= None
		Weapon 		= PRIMARY    RadagastWolfFangs
	End
	
	ArmorSet
		Conditions      = None
		Armor           = HeroArmor
		DamageFX        = NormalDamageFX
	End

	; This is required so that the build phase lasts as long as the anim.
	BuildFadeInOnCreateTime = 0
	
  	VisionRange 		= ANGMAR_DIREWOLF_VISION_RANGE
  	ShroudClearingRange 	= ANGMAR_DIREWOLF_SHROUD_RANGE
	
	VisionSide 		= 35%
	VisionRear 		= 25%
	
	MaxVisionBonusPercent 	= 300%
	VisionBonusTestRadius 	= 200
	VisionBonusPercentPerFoot = 2.0%

	BountyValue 		= GONDOR_GANDALFWHITE_BOUNTY_VALUE
	DisplayName 		= OBJECT:Radagast
	CrushableLevel 		= 2  		; What am I?:        0 = for infantry, 1 = for trees, 2 = general vehicles
	CommandSet = RadagastWolfCommandSet
 	CommandPoints = 50
	

	; ******************************************* AUDIO Parameters ***********************************;
	VoiceSelect = NeutralWargVoxSelect
	VoiceMove = NeutralWargVoxMove
	VoiceAttack = NeutralWargVoxAttack
;	
;	
	SoundAmbient				= WargAmbienceVOX
	SoundImpact				= ImpactHorse
	;SoundMoveLoop				= WargMoveFootsteps
	;SoundCrushing				= WargRiderCrushing 		; Sound made when crushing another unit underhoof
;
	;#include "..\includes\StandardUnitEvaEvents.inc"
;
;  	EvaEnemyObjectSightedEvent 		= WargRiderCreepSighted 	; Special event for wargs showing up. Helps distinguish the real enemies from random creeps
;	EvaEnemyObjectSightedAfterRespawnEvent 	= WargRiderCreepSighted 	; Event to run after the Cave Troll Lair is respawned. WARNING: This INI field only works for "SlavedUpdate.UseSlaverAsControlForEvaObjectSightedEvents = Yes" units
;	;EvaEventDieOwner			= GroupWargRiderDie		; Eva event to trigger on unit's death. NOTICE THAT this is only for permanent deaths
;										; For deaths you can respawn from, use the DeathFX
;
	ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
		MaxUpdateRangeCap = 800
		AnimationSound = Sound:WargMoveFootsteps Animation:KUDireWolf_RUNA Frames:0
		AnimationSound = Sound:WargMoveFootsteps Animation:KUDireWolf_TNL1 Frames:0
		AnimationSound = Sound:WargMoveFootsteps Animation:KUDireWolf_TNR1 Frames:0
		AnimationSound = Sound:WargMoveFootsteps Animation:KUDireWolf_TRNL Frames:0
		AnimationSound = Sound:WargMoveFootsteps Animation:KUDireWolf_TRNR Frames:0
		AnimationSound = Sound:WargMoveFootsteps Animation:KUDireWolf_ACCL Frames:0
;		AnimationSound = Sound:WargRiderTauntCallouts Animation:KUDireWolf_TNTA Frames:27
		AnimationSound = Sound:NeutralWargVoxAttack Animation:KUDireWolf_TNTA Frames:26 Animation:KUDireWolf_ATND Frames:7 Animation:KUDireWolf_HWLA Frames:17
		AnimationSound = Sound:WargTauntFootstep Animation:KUDireWolf_TNTA Frames:7 12 64 73
;		;AnimationSound = Sound:WargSaddleFoleySingles Animation:KUDireWolf_TNTA Frames:25 Animation:KUDireWolf_RUNA Frames:5 Animation:KUDireWolf_TNL1 Frames:5 Animation:KUDireWolf_TNR1 Frames:5 Animation:KUDireWolf_ACCL Frames:5 Animation:KUDireWolf_ATNA Frames:5 Animation:KUDireWolf_ATND Frames:5 Animation:KUDireWolf_GTPA Frames:5 101 Animation:KUDireWolf_HWLA Frames:15 Animation:KUDireWolf_RDYA Frames:5 Animation:KUDireWolf_RDYB Frames:5
	End
;
;	; Tie into LargeGroupAudio system
	Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
		Key = Warg Hero
	End
;

	; *** ENGINEERING Parameters ***

	RadarPriority = UNIT

      Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
      End

	KindOf = HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY SCORE GRAB_AND_DROP
	
	Body = RespawnBody ModuleTag_RespawnBody
		CheerRadius 			= EMOTION_CHEER_RADIUS
		MaxHealth         		= RADAGAST_HEALTH	;BALANCE Eomer Health
		PermanentlyKilledByFilter	= NONE		;Who kills me permanently?
   		DodgePercent      		= HERO_DODGE_PERCENT
	End
	Behavior = RespawnUpdate ModuleTag_RespawnUpdate
;		DeathAnim				= STUNNED				;Model condition to play when killed-to-respawn
		DeathAnim				= DYING  				;Model condition to play when killed-to-respawn
		DeathFX				= FX_BoromirDieToRespawn	;FXList to play when killed-to-respawn
		DeathAnimationTime		= 4966 ;1133			;How long DeathAnim will take.
		InitialSpawnFX			= FX_BoromirInitialSpawn
		RespawnAnim				= LEVELED				;Animation to play when respawning.
		RespawnFX				= FX_BoromirRespawn		;FXList to play when respawning.
		RespawnAnimationTime		= 2000				;Time it takes for respawn to play.
		AutoRespawnAtObjectFilter	= NONE +CASTLE_KEEP		;Respawn at this location -- and at it's exit production point if possible.
		ButtonImage				= HIRadagast_res
		RespawnAsTemplate			= ElvenRadagast
		
		;RespawnEntries determine the ruleset for how a character can be revived. Some units may automatically respawn, others
		;may require a specific revive action performed on him. You can specify different values for each level... or use Level:Any
		RespawnRules =			AutoSpawn:No	Cost:3500		Time:60000		Health:100%		;DEFAULT VALUES	
	End

	Behavior = AutoHealBehavior ModuleTag_BoromirHealing
		StartsActive = Yes
		HealingAmount = HERO_HEAL_AMOUNT
		HealingDelay = 1000
		StartHealingDelay = HERO_HEAL_DELAY
		HealOnlyIfNotInCombat = Yes
	End
	
	
	Behavior = AIUpdateInterface ModuleTag_03
		AutoAcquireEnemiesWhenIdle = Yes ATTACK_BUILDINGS
		AILuaEventsList		=	RadagastWolfFunctions
		BurningDeathTime	= BURNINGDEATH_DURATION_CAVALRY
	End

	LocomotorSet
		Locomotor = WargLocomotor
		Condition = SET_NORMAL 
		Speed     = NORMAL_MOUNTED_FAST_MEMBER_SPEED
	End	

	Behavior = PhysicsBehavior ModuleTag_04
		GravityMult = 1.0
		ShockStandingTime = 2533	;msec
	End
	
	; IsengardWargRider
	Behavior = HordeMemberCollide ModuleTag_HMC
		;nothing
	End
	
	Behavior = SquishCollide ModuleTag_06
		;nothing
	End

	Behavior = SlowDeathBehavior ModuleTag_08
		; Die and don't spawn horse
		DeathTypes = ALL 
		SinkDelay = 5000
		SinkRate = 1.50     ; in Dist/Sec
		DestructionDelay = 8000
		Sound = INITIAL WargVoxDie
	End

	;--------- SHAPESHIFT HUMAN ------------------------------------------------------------------------
 	Behavior = SpecialPowerModule ModuleTag_HorseToggleStarter                      
 		SpecialPowerTemplate		= SpecialAbilityShapeshiftOne
 		UpdateModuleStartsAttack	= Yes
 		StartsPaused				= No
		;InitiateSound				= FellBeastVoiceMove
 	End

	Behavior = ToggleMountedSpecialAbilityUpdate ModuleTag_HorseToggle
 		SpecialPowerTemplate    = SpecialAbilityShapeshiftOne
 		MountedTemplate			= ElvenRadagast 
 		SynchronizeTimerOnSpecialPower = SpecialAbilityAlarHeal SpecialAbilityElvenWood SpecialAbilityEagleAllies SpecialAbilityHeroMode SpecialAbilityRadagastEarthquake SpecialAbilityElrondRestoration SpecialAbilityLightningStrike SpecialAbilityGimliHeroMode
 		UnpackTime              = 2000
 		PreparationTime         = 0			; none, cause we hop onto our mount in no time at all :)
 		PackTime                = 0 		; none, cause we hop onto our mount in no time at all :)
 		OpacityTarget			= .0		; How see-thru to be at peak of change
 		AwardXPForTriggering    = 0
 		IgnoreFacingCheck		= Yes
		;TriggerSound			= FellBeastVoiceMove
            UnpackingVariation      = 1
	End

	;--------- BLEEDING FANGS ------------------------------------------------------------------------
	;Level 3
	;See RadagastWolfFangs
	;;; HORSE LORD LEADERSHIP ;;;	
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_Bleeding
		SpecialPowerTemplate = SpecialAbilityFakeLeadership
		TriggeredBy = Upgrade_ObjectLevel3
	End
	Behavior = WeaponSetUpgrade ModuleTag_RadagastBleedingUpgrade
		TriggeredBy		= Upgrade_ObjectLevel3
	End
	
	;--------- CALL THE PACK ------------------------------------------------------------------------
	;Level 5
	Behavior = QueueProductionExitUpdate ModuleTag_017
		UnitCreatePoint = X:-5.0 Y:-5.0 Z:0.0
		NaturalRallyPoint = X:5.0 Y:5.0 Z:0.0
		ExitDelay = STANDARD_HORDE_EXIT_DELAY
		PlacementViewAngle = 45
	End

	Behavior = SpawnBehavior ModuleTag_SpawnPack
		TriggeredBy = Upgrade_ObjectLevel5
		SpawnNumber = 8
		InitialBurst = 1
		SpawnTemplateName = ElvenRadagastWolfSlave
		SpawnReplaceDelay = 4500
		CanReclaimOrphans = Yes
	End
	
	;--------- SURVIVAL INSTINCT ------------------------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_SurvEnabler
		SpecialPowerTemplate = SpecialAbilityHeroMode
		TriggeredBy = Upgrade_ObjectLevel7
		ObeyRechageOnTrigger		= Yes
	End
	
	Behavior = WeaponModeSpecialPowerUpdate ModuleTag_SurvFighterPowerUpdate
		SpecialPowerTemplate	= SpecialAbilityHeroMode
		Duration				= 30000												; Needs to match SpecialAbilityGimliHeroMode
		AttributeModifier		= Slayer
		;LockWeaponSlot			= SECONDARY
		;WeaponSetFlags			= WEAPONSET_TOGGLE_1
		StartsPaused			= Yes
		;InitiateSound 			= AragornBladeMaster		;this doesn't work
	End

	;----------------- PREDATOR -------------------------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KnifeEnabler
		SpecialPowerTemplate = SpecialAbilityGimliHeroMode
		TriggeredBy = Upgrade_ObjectLevel10
		ObeyRechageOnTrigger		= Yes
	End

	Behavior = WeaponModeSpecialPowerUpdate ModuleTag_KnifeFighterPowerUpdate
		SpecialPowerTemplate	= SpecialAbilityGimliHeroMode
		Duration				= 30000												; Needs to match SpecialAbilityGimliHeroMode
		AttributeModifier		= Predator
		;LockWeaponSlot			= SECONDARY
;		WeaponSetFlags			= WEAPONSET_TOGGLE_1
		StartsPaused			= Yes
;		InitiateSound 			= DwarfZerkVoiceLeap		;this doesn't work
	End
	
	;--------------------- HIDE IN THE TREES ---------------------------------------	
	Behavior = InvisibilityUpdate ModuleTag_HideInTrees
		InvisibilityNugget
			InvisibilityType = CAMOUFLAGE
			DetectionRange   = CAMOUFLAGE_RADIUS
			ForbiddenConditions = AWAY_FROM_TREES FIRING_ANY
		End
		UpdatePeriod		= 2000
		StartsActive		= Yes
	End

	Behavior = AttributeModifierAuraUpdate ModuleTag_FaramirLeadership
		StartsActive	= No ;If no, requires upgrade to turn on.
		BonusName		= GenericHeroLeadership
		TriggeredBy		= Upgrade_ObjectLevel5
		RefreshDelay	= 2500
		Range			= 200
		AntiCategory	= BUFF
		ObjectFilter	= NONE +ElvenRadagastWolfSlave
	End	
	
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_TheodenLeadership
		SpecialPowerTemplate = SpecialAbilityFakeLeadership2
		TriggeredBy = Upgrade_FaramirLeadership
	End
	Behavior = SpecialPowerModule ModuleTag_TheodenLeadershipUpdate   
		SpecialPowerTemplate      = SpecialAbilityFakeLeadership2
		UpdateModuleStartsAttack  = No
		StartsPaused = Yes
	End

	;-------------------------------------------------------------------------------------------------	
	;---------------------------------- EARTHQUAKE ---------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_EarthquakeEnable
		SpecialPowerTemplate 	= SpecialAbilityRadagastEarthquake
		ObeyRechageOnTrigger		= Yes
		TriggeredBy 		= Upgrade_ObjectLevel10
	End
	
	Behavior = OCLSpecialPower ModuleTag_Earthquake
		SpecialPowerTemplate = SpecialAbilityRadagastEarthquake
		OCL                  = OCL_SpellBookEarthquake
        	;TriggerFX			 = FX_ElvenAlliesSummon
		CreateLocation       = CREATE_AT_LOCATION
		StartsPaused 		= Yes
	End

	;---------SUMMON EAGLE-----------------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_UnpauseSummonDunedain
		SpecialPowerTemplate		= SpecialAbilityEagleAllies
		TriggeredBy					= Upgrade_ObjectLevel5
		ObeyRechageOnTrigger		= Yes
	End

	Behavior = OCLSpecialPower ModuleTag_SummonDunedainOCL
		SpecialPowerTemplate = SpecialAbilityEagleAllies
		OCL                  = OCL_SpawnEagles
		CreateLocation       = CREATE_ABOVE_LOCATION
		UpgradeName			 = Upgrade_ObjectLevel5
		SetModelCondition	 = ModelConditionState:USER_1
		StartsPaused 		= Yes
	End
	
	;--------- YAVANNA'S REBIRTH -----------------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_UnpauseElvenWood
		SpecialPowerTemplate		= SpecialAbilityElvenWood
		TriggeredBy					= Upgrade_ObjectLevel7
		ObeyRechageOnTrigger		= Yes
	End
	
	Behavior           = ElvenWoodSpecialPower ModuleTag_ElvenWood
		SpecialPowerTemplate	= SpecialAbilityElvenWood
		ElvenGroveObject		= ElvenGrove
		ElvenWoodRadius			= SPELLBOOK_TAINT_RADIUS
		ElvenWoodFX				= FX_ElvenWoodSpellFX
		ElvenWoodOCL			= OCL_RadagastWoodSeed
;		CreateLocation			= CREATE_AT_LOCATION
		StartsPaused 		= Yes
	End
    ;--------------------------------------------------------------------------------------------
    ;------------------------- HEAL -------------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_HealEnabler
		SpecialPowerTemplate	= SpecialAbilityAlarHeal
		ObeyRechageOnTrigger		= Yes
		TriggeredBy				= Upgrade_ObjectLevel3
	End
	
  	Behavior = PlayerHealSpecialPower ModuleTag_Heal
		SpecialPowerTemplate  = SpecialAbilityAlarHeal
		HealAffects			  = INFANTRY CAVALRY MONSTER MACHINE SHIP DOZER
		HealAmount			  = 0.8 ;1.0	; 0.5 = 50% of maximum health
		HealRadius			  = SPELL_HEAL_RADIUS_UNIT_SCAN
		HealFX				  = FX_SpellHealUnitHealBuff		;FX_DefaultUnitHealBuff
		; To replenish hordes a bit
		HealOCL               = OCL_HealSpellHordeReplenishPing
		StartsPaused		  	  = Yes
	End
	
	;------------------------- RESTORATION -------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_RestorationUnpause
		SpecialPowerTemplate		= SpecialAbilityElrondRestoration
		ObeyRechageOnTrigger		= Yes
		TriggeredBy					= Upgrade_ObjectLevel7
	End
	Behavior = SpecialPowerTimerRefreshSpecialPower ModuleTag_RestorationRefresh
		SpecialPowerTemplate		= SpecialAbilityElrondRestoration
		StartsPaused				= Yes
		UpdateModuleStartsAttack	= No
		AffectAllies				= Yes
		AttributeModifierRange		= 150
		AttributeModifierAffects	= ALL -ElvenElrond ALLIES
		SetModelCondition			= ModelConditionState:USER_1
		SetModelConditionTime		= 3.66
	End
  	Behavior = PlayerHealSpecialPower ModuleTag_RestorationHeal
		SpecialPowerTemplate		= SpecialAbilityElrondRestorationHeal
		HealAffects					= INFANTRY CAVALRY MONSTER
		HealAmount					= 0.8 ; percent of max health
		HealRadius					= 150
		HealFX						= FX_ElrondHealSpecialPower
	End
	
	;------------------------ MANWE'S FURY -------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_LightningEnabler
		SpecialPowerTemplate	= SpecialAbilityLightningStrike
		ObeyRechageOnTrigger		= Yes
		TriggeredBy				= Upgrade_ObjectLevel10
	End

	Behavior = SpecialPowerModule ModuleTag_LightningStrike                      
		SpecialPowerTemplate		= SpecialAbilityLightningStrike
		UpdateModuleStartsAttack	= Yes
		StartsPaused				= Yes
		InitiateSound				= WizardTowerLightningStrikeRumbleMS
	End

	Behavior = ArrowStormUpdate ModuleTag_ShootLightningBolts
		SpecialPowerTemplate    = SpecialAbilityLightningStrike
		StartAbilityRange       = ISENGARD_WIZARDSTOWER_LIGHTNING_RANGE
		CanShootEmptyGround		= Yes
		
		UnpackTime              = 2500	;// Pull out arrow
		PreparationTime         = 1		;// Quick shot
		PersistentPrepTime      = 500	;// looping the quick shot
		PackTime                = 1500	;// back to idle

		ApproachRequiresLOS     = No	;// required so that it doesn't shoot through walls
		AwardXPForTriggering    = 0
		
		;ActiveLoopSound			= GandalfLightningLoop  ;// Sound loops entire time ability is actively firing

		;//Specific to ArrowStorm
		WeaponTemplate  = ManweFuryLightningWeapon
		TargetRadius    = ISENGARD_WIZARDSTOWER_LIGHTNING_FIRE_RADIUS
		ShotsPerTarget  = 1
		ShotsPerBurst   = 1
		MaxShots        = ISENGARD_WIZARDSTOWER_LIGHTNING_NUMSHOTS  ;// will double up if run out of targets
	        
      End

	;-------------- ANIMAL COMPANIONS ----------------

	Behavior = SpawnBehavior ModuleTag_Spawn1
		TriggeredBy = Upgrade_ObjectLevel1
		SpawnNumber = 1
		InitialBurst = 1
		SpawnTemplateName = ElvenRadagastWolfCompanion
		SpawnReplaceDelay = 4500
		CanReclaimOrphans = Yes
	End

	Behavior = SpawnBehavior ModuleTag_Spawn2
		TriggeredBy = Upgrade_ObjectLevel3
		SpawnNumber = 1
		InitialBurst = 1
		SpawnTemplateName = ElvenRadagastWolfCompanion
		SpawnReplaceDelay = 4500
		CanReclaimOrphans = Yes
	End

	Behavior = SpawnBehavior ModuleTag_Spawn3
		TriggeredBy = Upgrade_ObjectLevel5
		SpawnNumber = 1
		InitialBurst = 1
		SpawnTemplateName = ElvenRadagastWolfCompanion
		SpawnReplaceDelay = 4500
		CanReclaimOrphans = Yes
	End

	Scale = 1.2
	
	Geometry = CYLINDER
	GeometryMajorRadius = 8
	GeometryMinorRadius = 8
	GeometryHeight = 20.0
	GeometryIsSmall = Yes

	Shadow = SHADOW_DECAL
	ShadowSizeX = 30;
	ShadowSizeY = 20;
	ShadowTexture = ShadowI;

	; *** AUTO RESOLVE DATA *** 
	AutoResolveUnitType = AutoResolveUnit_Hero
	AutoResolveCombatChain = AutoResolve_HeroCombatChain

	AutoResolveBody = AutoResolve_GandalfBody
	
	AutoResolveWeapon
		Weapon = AutoResolve_GandalfWeapon
	End
	AutoResolveArmor
		Armor = AutoResolve_GandalfArmor
	End

End


;-----------------------------------------------------------------------------
;
;	Radagast Eagle.ini
;
;-----------------------------------------------------------------------------

Object ElvenRadagastEagle  

	ShockwaveResistance = SHOCKWAVE_RESISTANCE_ALWAYS
                       
	; *** ART Parameters ***

    ; SelectPortrait for Heros is portrait behind skill buttons. HP = HeroPortrait.
	SelectPortrait = HPRadagast

    ; ButtonImage for Heros is button image on Hero Select UI to select hero. HI = HeroIcon or HeroImage.
	ButtonImage = HIRadagast

	Draw = W3DScriptedModelDraw ModuleTag_02
		  
		  OkToChangeModelColor = Yes
		  
  		StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD

		ExtraPublicBone = B_Passenger
	
		DefaultModelConditionState
			Model               = GUGwaihir_SKN
			Skeleton            = GUGwaihir_SKL
		End

		ModelConditionState		=	USER_3
			Model               = GUGwaihir_SKN
		End

		RandomTexture = CURdgEagle.tga 0 GUGwaihir.tga
		
		IdleAnimationState
			StateName = Idle
			Animation           = FlyB
				AnimationName     = GUGwaihir_HVRA
				AnimationMode     = LOOP
				AnimationBlendTime = 10
				
			End
		End

            AnimationState = SPECIAL_WEAPON_THREE
                  Animation = atkc
				AnimationName = GUGwaihir_ATKC
				AnimationMode = ONCE
                  End
            End

		AnimationState  STUNNED SPECIAL_DAMAGED
			StateName =  STUNNED
			Animation = HitB
				AnimationName = GUGwaihir_HITB
				AnimationMode = ONCE
				AnimationBlendTime = 6
			End
		End
		AnimationState  STUNNED
			Animation = HitB
				AnimationName = GUGwaihir_HITA
				AnimationMode = ONCE
				AnimationBlendTime = 6
			End
		End


 		AnimationState	= BACKING_UP
   			StateName = backup
   			Animation = FlyB
   				AnimationName = GUGwaihir_FLYB
   				AnimationMode = LOOP
   				AnimationBlendTime = 9
   			End
   		End

   		AnimationState = DIVING
   			StateName = Diving
   			Animation = DiveA
   				AnimationName = GUGwaihir_DIVA
   				AnimationMode = LOOP
   				AnimationBlendTime = 9
   			End
   		End

		AnimationState = ABOUT_TO_HIT								; clawing
			StateName = Claw
			Animation = Claw
				AnimationName = GUGwaihir_ATKB
				AnimationMode = LOOP
				AnimationBlendTime = 9
			End
		End

		;--- HARD FLAPPING ------------------------
		AnimationState = CLIMBING
			StateName = Climbing
			Animation = FlyB(climb)
				AnimationName = GUGwaihir_FLYB
				AnimationMode = LOOP
				AnimationBlendTime = 9
				AnimationSpeedFactorRange = 1.5 1.55
			End
		End
		AnimationState = FREEFALL
			StateName = Freefall
			Animation = Freefall(ilde)
				AnimationName = GUGwaihir_IDLA
				AnimationMode = LOOP
				AnimationBlendTime = 9
				AnimationSpeedFactorRange = 0.7 0.75
			End
		End
	

		AnimationState = MOVING
			StateName = Moving
			Animation           = FLYA
				AnimationName     = GUGwaihir_FLYA
				AnimationMode     = LOOP
				AnimationBlendTime  = 12
			End

			BeginScript
 				Prev = CurDrawablePrevAnimationState()
 				if Prev == "Idle"	then CurDrawableSetTransitionAnimState("Trans_Begin_Moving") return end
 			EndScript
		End
   	    TransitionState = Trans_Begin_Moving
   			Animation = Transition
   				AnimationName = GUGwaihir_HVRC
   				AnimationMode = ONCE
   				AnimationBlendTime = 4
   			End  
   		End			

	    TransitionState = Trans_Dying
			Animation = Transition
				AnimationName = GUGwaihir_DIED
				AnimationMode = ONCE
				AnimationBlendTime = 9
			End  
		End			


		AnimationState = DYING DEATH_1
			StateName = DYING
			Animation = DyingA
				AnimationName = GUGwaihir_DIEE
				AnimationMode = LOOP
				AnimationBlendTime = 9
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "Idle"	then CurDrawableSetTransitionAnimState("Trans_Dying") return end
				if Prev == "Moving"	then CurDrawableSetTransitionAnimState("Trans_Dying") return end
			EndScript
	    End

		AnimationState = DYING DEATH_2
			StateName = DYING
			Animation = DyingA
				AnimationName = GUGwaihir_HVRA
				AnimationMode = LOOP
				AnimationBlendTime = 9
			End
	    End


	End
	
	; ***DESIGN parameters ***
	Side				= Elves
	EditorSorting		= UNIT
	ThreatLevel			= GANDALF_THREAT_LEVEL
	ThingClass			= LARGE_MONSTER
	TransportSlotCount	= TRANSPORTSLOTCOUNT_NOT_TRANSPORTABLE
  
	WeaponSet
		Conditions		= None
		Weapon          	= PRIMARY		EagleGrabAttack ;RadagastEagleGrabAttack
		PreferredAgainst	= PRIMARY		INFANTRY THROWN_OBJECT CAVALRY

		Weapon				= SECONDARY		EagleClawAttack ;RadagastEagleClawAttack
		OnlyAgainst			= SECONDARY		MONSTER

		Weapon              = TERTIARY		EaglePlowAttack ;RadagastEaglePlowAttack
		PreferredAgainst	= TERTIARY		STRUCTURE MACHINE HORDE	
		
		Weapon				= QUATERNARY	RadagastEagleClawWyrmAttack
		PreferredAgainst	= QUATERNARY	CLEANUP_HAZARD				; Used as a user defined kindof, only the wyrm uses it.
	End

	ArmorSet
		Conditions      = None
		Armor           = EagleHeroArmor ;HeroArmor
		DamageFX        = GwaihirDamageFX
	End	
	
	VisionRange = VISION_FLIER
	ShroudClearingRange = SHROUD_CLEAR_FLIER

	BountyValue = GONDOR_GANDALFWHITE_BOUNTY_VALUE
	DisplayName = OBJECT:Radagast
	;//DisplayMeleeDamage = EAGLE_PLOW_DAMAGE_INNER

	CrusherLevel           = 3  ;What can I crush?: 1 = infantry, 2 = trees, 3 = vehicles
	RamPower = 30;
	RamZMult = 0.5;
	CommandSet = RadagastEagleCommandSet
	CommandPoints = 50
	

	; *** AUDIO Parameters ***;

	VoiceAttack			= EagleVoiceAttack
	VoiceMove			= EagleVoiceMove
	VoicePriority			= 60
	VoiceSelect			= EagleVoiceSelect
	VoiceGuard			= EagleVoiceMove

	SoundAmbient			= EagleAmbienceVoice
	SoundImpact			= ImpactHorse

	
	;UnitSpecificSounds
	;End

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"

	ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
		MaxUpdateRangeCap = 800
		AnimationSound = Sound: EagleWingFlaps		Animation:GUGwaihir_SKL.GUGWAIHIR_FLYA Frames: 2
		AnimationSound = Sound: EagleWingFlaps		Animation:GUGwaihir_SKL.GUGWAIHIR_FLYB Frames: 2 
		AnimationSound = Sound: EagleWingFlaps		Animation:GUGwaihir_SKL.GUGWAIHIR_FLYC Frames: 2 63
		;AnimationSound = Sound: EagleWingFlaps		Animation:GUGwaihir_SKL.GUGWAIHIR_FLYC Frames: 4 34 

		AnimationSound = Sound: EagleWingFlaps		Animation:GUGwaihir_SKL.GUGWAIHIR_HVRA Frames: 4
		AnimationSound = Sound: EagleWingFlaps		Animation:GUGwaihir_SKL.GUGWAIHIR_HVRC Frames: 4

		AnimationSound = Sound: EagleWingFlaps		Animation:GUGwaihir_SKL.GUGWAIHIR_HITA Frames: 0
		AnimationSound = Sound: EagleWingFlaps		Animation:GUGwaihir_SKL.GUGWAIHIR_HITB Frames: 0

		AnimationSound = Sound: EagleHurt		Animation:GUGwaihir_SKL.GUGWAIHIR_HITA Frames: 1
		AnimationSound = Sound: EagleHurt		Animation:GUGwaihir_SKL.GUGWAIHIR_HITB Frames: 1
		AnimationSound = Sound: EagleHurt		Animation:GUGwaihir_SKL.GUGWAIHIR_DIED Frames: 1

		AnimationSound = Sound: EagleWingFlaps		Animation:GUGwaihir_SKL.GUGWAIHIR_ATKB Frames: 0
		AnimationSound = Sound: EagleWingFlaps		Animation:GUGwaihir_SKL.GUGWAIHIR_GRBB Frames: 0

		AnimationSound = Sound: EagleAttack		Animation:GUGwaihir_SKL.GUGWAIHIR_ATKB Frames: 1
		AnimationSound = Sound: EagleAttack		Animation:GUGwaihir_SKL.GUGWAIHIR_GRBB Frames: 1

		AnimationSound = Sound: EagleWingFlaps		Animation:GUGwaihir_SKL.GUGWAIHIR_DIED Frames: 0
		AnimationSound = Sound: TrollBodyfall		Animation:GUGwaihir_SKL.GUGWAIHIR_DIEF Frames: 2
		AnimationSound = Sound: EagleWingFlaps		Animation:GUGwaihir_SKL.GUGWAIHIR_DIEF Frames: 0
	End

	; Tie into LargeGroupAudio system
	; No, we never do anything with this unit
	;Behavior = LargeGroupAudioUpdate ModuleTag_LGAU
	;	Key = Eagle Unit Flyer
	;End


	; *** ENGINEERING Parameters ***
	RadarPriority		= UNIT
	KindOf                  = PRELOAD HERO SELECTABLE CAN_CAST_REFLECTIONS SCORE NO_FREEWILL_ENTER MONSTER SCARY CANNOT_RETALIATE
	Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
      End

	
	Body = RespawnBody ModuleTag_RespawnBody
		CheerRadius 			= EMOTION_CHEER_RADIUS
		MaxHealth         		= RADAGAST_HEALTH ;BALANCE Eomer Health
		PermanentlyKilledByFilter	= NONE		;Who kills me permanently?
   		DodgePercent      		= HERO_DODGE_PERCENT
	End
	Behavior = RespawnUpdate ModuleTag_RespawnUpdate
;		DeathAnim				= STUNNED				;Model condition to play when killed-to-respawn
		DeathAnim				= DYING  				;Model condition to play when killed-to-respawn
		DeathFX				= FX_BoromirDieToRespawn	;FXList to play when killed-to-respawn
		DeathAnimationTime		= 4966 ;1133			;How long DeathAnim will take.
		InitialSpawnFX			= FX_BoromirInitialSpawn
		RespawnAnim				= LEVELED				;Animation to play when respawning.
		RespawnFX				= FX_BoromirRespawn		;FXList to play when respawning.
		RespawnAnimationTime		= 2000				;Time it takes for respawn to play.
		AutoRespawnAtObjectFilter	= NONE +CASTLE_KEEP		;Respawn at this location -- and at it's exit production point if possible.
		ButtonImage				= HIRadagast_res
		RespawnAsTemplate			= ElvenRadagast
		
		;RespawnEntries determine the ruleset for how a character can be revived. Some units may automatically respawn, others
		;may require a specific revive action performed on him. You can specify different values for each level... or use Level:Any
		RespawnRules =			AutoSpawn:No	Cost:3500		Time:60000		Health:100%		;DEFAULT VALUES	
	End

	Behavior = AutoHealBehavior ModuleTag_GwaihirHealing
		StartsActive = Yes
		HealingAmount = HERO_HEAL_AMOUNT
		HealingDelay = 1000
		StartHealingDelay = 15000
		HealOnlyIfNotInCombat = Yes
	End
	
	Behavior = GiantBirdAIUpdate ModuleTag_GiantBirdAI
		AutoAcquireEnemiesWhenIdle	=	Yes ATTACK_BUILDINGS
		MoodAttackCheckRate			=	500
		AILuaEventsList				=	GwaihirFunctions	
		
		FollowThroughDistance		=	160
		FollowThroughCheckStep		=	50
		FollowThroughGradient		=	1.0
		
		GrabTossTimeTrigger			=	3.0
		GrabTossHeightTrigger		=   80.0
		TossFX				= FX_DiebyFalling
		SpecialContactPoints		= Swoop
		
		AttackPriority = AttackPriority_Eagle
	End

	Behavior = ModelConditionUpgrade ModuleTag_All_FactionUpgrade
		TriggeredBy				= Upgrade_AllFactionUpgrade
		AddConditionFlags		= USER_3
		Permanent				= Yes
	End
	
	LocomotorSet
		Locomotor = FellBeastLocomotor ;BALANCE Gwaihir
		Condition = SET_NORMAL 
		Speed     = 93
	End
	LocomotorSet
		Locomotor = FellBeastLocomotor ;BALANCE Gwaihir
		Condition = SET_SUPERSONIC 
		Speed     = 114
	End
	LocomotorSet
		Locomotor = FellBeastLocomotor ; BALANCE Gwaihir
		Condition = SET_WANDER 
		Speed     = 78
	End

	
	Behavior = PhysicsBehavior ModuleTag_04
	End
	
	Behavior = NotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
	End

	
	Behavior = TransportContain TransportContainModuleTag
		ObjectStatusOfContained = UNSELECTABLE UNATTACKABLE
		PassengerFilter = ANY +INFANTRY +HULK +CAVALRY +GRAB_AND_DROP -HERO -PORTER -TROLL -MordorMountainTroll -MordorDrummerTroll -GoblinCaveTroll -GoblinCaveTroll_FromTrollLair -MordorCaveTroll_Summoned -MordorAttackTroll -MordorAttackTroll_Summoned
		Slots = 1
		ShowPips = No
		CanGrabStructure = Yes
		AllowEnemiesInside = Yes
		AllowNeutralInside = Yes
		AllowAlliesInside  = No
		DamagePercentToUnits = 100%
		KillPassengersOnDeath = Yes
		PassengerBonePrefix = PassengerBone:B_Passenger       KindOf:GRAB_AND_DROP
		GrabWeapon = FellbeastGrabWeapon		; fire this weapon when eagle grabs a victim
		FireGrabWeaponOnVictim = No
		
		ReleaseSnappyness = 0.05 ; 1.0 is very snappy, 0.0 is very loose

	End
	
	Behavior = SquishCollide ModuleTag_06
		;nothing
	End
	
;	Behavior = GiantBirdSlowDeathBehavior ModuleTag_GiantBirdSlowDeath
;		DeathTypes = ALL ;-KNOCKBACK
;		SinkDelay = 8000
;		SinkRate = 1.6     ; in Dist/Sec
;		DestructionDelay = 15000
;		
;		Sound	= INITIAL	EagleVoiceDie			;FellBeastDie
;		Weapon	= HIT_GROUND	GondorTrebuchetRockWarhead
;		FX = INITIAL FX_FellBeastSpell
;		Sound	= HIT_GROUND	FellBeastDieImpact
;
;		CrashAvoidKindOfs = STRUCTURE
;		CrashAvoidRadius  = 800
;		CrashAvoidStrength = 0.2
;		NeedToMaintainFlailingHeight = No
;									
;	End

	Behavior = SlowDeathBehavior ModuleTag_SlowDeath
		DeathTypes = ALL -FADED
		DestructionDelay = 1000
		ShadowWhenDead = No
		FX = INITIAL FX_GwaihirDeath
		Sound = INITIAL EagleVoiceDie
	        DeathFlags = DEATH_1
	End
	
  	Behavior = SlowDeathBehavior ModuleTag_FadeDeath
		DeathTypes = NONE +FADED
		FadeDelay = 0
		FadeTime = 2500
		DestructionDelay = 2500
		;Sound = INITIAL EagleVoiceDie	
	        DeathFlags = DEATH_2
	End
	
	FormationPreviewDecal 
        	Texture = FPflyingUnitDecal
        	Width = 128
        	Height = 128
    	End


	;---------SHAPESHIFT HUMAN------------------------------------------------------------------------
 	Behavior = SpecialPowerModule ModuleTag_DismountStarter
 		SpecialPowerTemplate		= SpecialAbilityShapeshiftOne
 		UpdateModuleStartsAttack	= Yes
 		StartsPaused				= No
		InitiateSound				= FellBeastVoiceMove
 	End
	Behavior = ToggleMountedSpecialAbilityUpdate ModuleTag_Dismount
 		SpecialPowerTemplate    = SpecialAbilityShapeshiftOne
 		StartAbilityRange		= 50.0									; pretty small so we are forced to the right place.
 		MountedTemplate			= ElvenRadagast
 		SynchronizeTimerOnSpecialPower = SpecialAbilityAlarHeal SpecialAbilityElvenWood SpecialAbilityEagleAllies SpecialAbilityHeroMode SpecialAbilityRadagastEarthquake SpecialAbilityElrondRestoration SpecialAbilityLightningStrike SpecialAbilityGimliHeroMode
 		UnpackTime              = 0
 		PreparationTime         = 1  
; 		PersistentPrepTime      = 250
 		PackTime                = 0
 		OpacityTarget			= 1										; How see-thru to be at peak of change
 		AwardXPForTriggering    = 0
 		IgnoreFacingCheck		= Yes
	End

	;---------------------- EAGLE EYE ------------------------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_EagleEye
		SpecialPowerTemplate = SpecialAbilityFakeLeadership
		TriggeredBy = Upgrade_ObjectLevel2
	End
     Behavior = StealthDetectorUpdate ModuleTag_CreateAHeroWTrueSightUpdate
	     DetectionRange		= 2000	// range to detect
	     DetectionRate		= 10   // how often to rescan for stealthed things in my sight (msec)
	     CancelOneRingEffect = Yes	// forces uses of one-ring to pop out of it
	     InitiallyDisabled	= No
     End

    ;------------------------- HEAL -------------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_HealEnabler
		SpecialPowerTemplate	= SpecialAbilityAlarHeal
		ObeyRechageOnTrigger		= Yes
		TriggeredBy				= Upgrade_ObjectLevel3
	End
	
  	Behavior = PlayerHealSpecialPower ModuleTag_Heal
		SpecialPowerTemplate  = SpecialAbilityAlarHeal
		HealAffects			  = INFANTRY CAVALRY MONSTER MACHINE SHIP DOZER
		HealAmount			  = 0.8 ;1.0	; 0.5 = 50% of maximum health
		HealRadius			  = SPELL_HEAL_RADIUS_UNIT_SCAN
		HealFX				  = FX_SpellHealUnitHealBuff		;FX_DefaultUnitHealBuff
		; To replenish hordes a bit
		HealOCL               = OCL_HealSpellHordeReplenishPing
		StartsPaused		  	  = Yes
	End
	
	;------------------------- RESTORATION -------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_RestorationUnpause
		SpecialPowerTemplate		= SpecialAbilityElrondRestoration
		ObeyRechageOnTrigger		= Yes
		TriggeredBy					= Upgrade_ObjectLevel7
	End
	Behavior = SpecialPowerTimerRefreshSpecialPower ModuleTag_RestorationRefresh
		SpecialPowerTemplate		= SpecialAbilityElrondRestoration
		StartsPaused				= Yes
		UpdateModuleStartsAttack	= No
		AffectAllies				= Yes
		AttributeModifierRange		= 150
		AttributeModifierAffects	= ALL -ElvenElrond ALLIES
		SetModelCondition			= ModelConditionState:USER_1
		SetModelConditionTime		= 3.66
	End
  	Behavior = PlayerHealSpecialPower ModuleTag_RestorationHeal
		SpecialPowerTemplate		= SpecialAbilityElrondRestorationHeal
		HealAffects					= INFANTRY CAVALRY MONSTER
		HealAmount					= 0.8 ; percent of max health
		HealRadius					= 150
		HealFX						= FX_ElrondHealSpecialPower
	End
	
	;------------------------ MANWE'S FURY -------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_LightningEnabler
		SpecialPowerTemplate	= SpecialAbilityLightningStrike
		ObeyRechageOnTrigger		= Yes
		TriggeredBy				= Upgrade_ObjectLevel10
	End

	Behavior = SpecialPowerModule ModuleTag_LightningStrike                      
		SpecialPowerTemplate		= SpecialAbilityLightningStrike
		UpdateModuleStartsAttack	= Yes
		StartsPaused				= Yes
		InitiateSound				= WizardTowerLightningStrikeRumbleMS
	End

	Behavior = ArrowStormUpdate ModuleTag_ShootLightningBolts
		SpecialPowerTemplate    = SpecialAbilityLightningStrike
		StartAbilityRange       = ISENGARD_WIZARDSTOWER_LIGHTNING_RANGE
		CanShootEmptyGround		= Yes
		
		UnpackTime              = 2500	;// Pull out arrow
		PreparationTime         = 1		;// Quick shot
		PersistentPrepTime      = 500	;// looping the quick shot
		PackTime                = 1500	;// back to idle

		ApproachRequiresLOS     = No	;// required so that it doesn't shoot through walls
		AwardXPForTriggering    = 0
		
		;ActiveLoopSound			= GandalfLightningLoop  ;// Sound loops entire time ability is actively firing

		;//Specific to ArrowStorm
		WeaponTemplate  = ManweFuryLightningWeapon
		TargetRadius    = ISENGARD_WIZARDSTOWER_LIGHTNING_FIRE_RADIUS
		ShotsPerTarget  = 1
		ShotsPerBurst   = 1
		MaxShots        = ISENGARD_WIZARDSTOWER_LIGHTNING_NUMSHOTS  ;// will double up if run out of targets
	        
      End

      Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_FireLightningBolts
             SpecialPowerTemplate   = SpecialAbilityLightningStrike
             WhichSpecialWeapon            = 1
      End

	;----------------------------------------------------------------------------------------------------
	;--------- SURVIVAL INSTINCT ------------------------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_SurvEnabler
		SpecialPowerTemplate = SpecialAbilityHeroMode
		TriggeredBy = Upgrade_ObjectLevel7
		ObeyRechageOnTrigger		= Yes
	End
	
	Behavior = WeaponModeSpecialPowerUpdate ModuleTag_SurvFighterPowerUpdate
		SpecialPowerTemplate	= SpecialAbilityHeroMode
		Duration				= 30000												; Needs to match SpecialAbilityGimliHeroMode
		AttributeModifier		= Slayer
		;LockWeaponSlot			= SECONDARY
		;WeaponSetFlags			= WEAPONSET_TOGGLE_1
		StartsPaused			= Yes
		;InitiateSound 			= AragornBladeMaster		;this doesn't work
	End

	;----------------- PREDATOR -------------------------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KnifeEnabler
		SpecialPowerTemplate = SpecialAbilityGimliHeroMode
		TriggeredBy = Upgrade_ObjectLevel10
		ObeyRechageOnTrigger		= Yes
	End

	Behavior = WeaponModeSpecialPowerUpdate ModuleTag_KnifeFighterPowerUpdate
		SpecialPowerTemplate	= SpecialAbilityGimliHeroMode
		Duration				= 30000												; Needs to match SpecialAbilityGimliHeroMode
		AttributeModifier		= Predator
		;LockWeaponSlot			= SECONDARY
;		WeaponSetFlags			= WEAPONSET_TOGGLE_1
		StartsPaused			= Yes
;		InitiateSound 			= DwarfZerkVoiceLeap		;this doesn't work
	End	

	;---------SUMMON EAGLE-----------------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_UnpauseSummonDunedain
		SpecialPowerTemplate		= SpecialAbilityEagleAllies
		TriggeredBy					= Upgrade_ObjectLevel5
		ObeyRechageOnTrigger		= Yes
	End

	Behavior = OCLSpecialPower ModuleTag_SummonDunedainOCL
		SpecialPowerTemplate = SpecialAbilityEagleAllies
		OCL                  = OCL_SpawnEagles
		CreateLocation       = CREATE_ABOVE_LOCATION
		UpgradeName			 = Upgrade_ObjectLevel5
		SetModelCondition	 = ModelConditionState:USER_1
		StartsPaused 		= Yes
	End
	
	;--------- YAVANNA'S REBIRTH -----------------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_UnpauseElvenWood
		SpecialPowerTemplate		= SpecialAbilityElvenWood
		TriggeredBy					= Upgrade_ObjectLevel7
		ObeyRechageOnTrigger		= Yes
	End
	
	Behavior           = ElvenWoodSpecialPower ModuleTag_ElvenWood
		SpecialPowerTemplate	= SpecialAbilityElvenWood
		ElvenGroveObject		= ElvenGrove
		ElvenWoodRadius			= SPELLBOOK_TAINT_RADIUS
		ElvenWoodFX				= FX_ElvenWoodSpellFX
		ElvenWoodOCL			= OCL_RadagastWoodSeed
;		CreateLocation			= CREATE_AT_LOCATION
		StartsPaused 		= Yes
	End

	;---------------------------------- EARTHQUAKE ---------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_EarthquakeEnable
		SpecialPowerTemplate 	= SpecialAbilityRadagastEarthquake
		ObeyRechageOnTrigger		= Yes
		TriggeredBy 		= Upgrade_ObjectLevel10
	End
	
	Behavior = OCLSpecialPower ModuleTag_Earthquake
		SpecialPowerTemplate = SpecialAbilityRadagastEarthquake
		OCL                  = OCL_SpellBookEarthquake
        	;TriggerFX			 = FX_ElvenAlliesSummon
		CreateLocation       = CREATE_AT_LOCATION
		StartsPaused 		= Yes
	End

	;-------------- ANIMAL COMPANIONS ----------------
	Behavior = QueueProductionExitUpdate ModuleTag_017
		UnitCreatePoint = X:-5.0 Y:-5.0 Z:0.0
		NaturalRallyPoint = X:5.0 Y:5.0 Z:0.0
		ExitDelay = STANDARD_HORDE_EXIT_DELAY
		PlacementViewAngle = 45
	End

	Behavior = SpawnBehavior ModuleTag_Spawn1
		TriggeredBy = Upgrade_ObjectLevel1
		SpawnNumber = 1
		InitialBurst = 1
		SpawnTemplateName = ElvenRadagastWolfCompanion
		SpawnReplaceDelay = 4500
		CanReclaimOrphans = Yes
	End

	Behavior = SpawnBehavior ModuleTag_Spawn2
		TriggeredBy = Upgrade_ObjectLevel3
		SpawnNumber = 1
		InitialBurst = 1
		SpawnTemplateName = ElvenRadagastWolfCompanion
		SpawnReplaceDelay = 4500
		CanReclaimOrphans = Yes
	End

	Behavior = SpawnBehavior ModuleTag_Spawn3
		TriggeredBy = Upgrade_ObjectLevel5
		SpawnNumber = 1
		InitialBurst = 1
		SpawnTemplateName = ElvenRadagastWolfCompanion
		SpawnReplaceDelay = 4500
		CanReclaimOrphans = Yes
	End

 
	/////////////////////
	// AISpecialPowers
	/////////////////////


	Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
		CommandButtonName = Command_SetStanceBattle
		SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
	End

	Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
		CommandButtonName = Command_SetStanceAggressive
		SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
	End

	Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
		CommandButtonName = Command_SetStanceHoldGround
		SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
	End

	; *** AUTO RESOLVE DATA *** 
	AutoResolveUnitType = AutoResolveUnit_Hero
	AutoResolveCombatChain = AutoResolve_HeroCombatChain

	AutoResolveBody = AutoResolve_GandalfBody
	
	AutoResolveWeapon
		Weapon = AutoResolve_GandalfWeapon
	End
	AutoResolveArmor
		Armor = AutoResolve_GandalfArmor
	End

	Scale = 0.7

	Geometry				= CYLINDER
	GeometryMajorRadius 	= 30.0
	GeometryMinorRadius 	= 30.0
	GeometryHeight			= 16.0
	GeometryIsSmall			= No
	
	HealthBoxScale			= 3.0
	HealthBoxHeightOffset	= 25.0	
	
	Shadow = SHADOW_VOLUME_NON_SELF_3	// volumetric shadow that doesn't cast onto all objects using SHADOW_VOLUME_NON_SELF_3
	ShadowSunAngle = 89					// clamp the angle so shadow casts straight down.
End

;-----------------------------------------------------------------------------
;
;	Radagast Bear.ini
;
;-----------------------------------------------------------------------------
Object ElvenRadagastBear

	; *** ART Parameters ***
	; NOTE: If you are updating any of the art parameters, you should really check
	; GondorCavalryRiderless in FactionSubObject.ini and see if it needs to be updated
	
    ; SelectPortrait for Heros is portrait behind skill buttons. HP = HeroPortrait.
	SelectPortrait = HPRadagast

    ; ButtonImage for Heros is button image on Hero Select UI to select hero. HI = HeroIcon or HeroImage.
	ButtonImage = HIRadagast

	Draw = W3DHordeModelDraw ModuleTag_01
	
	  OkToChangeModelColor = Yes
		
		StaticModelLODMode = Yes
		
		; specify options for static LODs
		LodOptions				= LOW
			AllowMultipleModels		= ALLOW_MULTIPLE_MODELS_LOW
			MaxRandomTextures		= MAX_RANDOM_TEXTURES_LOW
			MaxRandomAnimations		= MAX_RANDOM_ANIMATIONS_LOW
			MaxAnimFrameDelta		= MAX_ANIM_FRAME_DELTA_LOW
		End
		
		LodOptions				= MEDIUM
			AllowMultipleModels		= ALLOW_MULTIPLE_MODELS_MED
			MaxRandomTextures		= MAX_RANDOM_TEXTURES_MED
			MaxRandomAnimations		= MAX_RANDOM_ANIMATIONS_MED
			MaxAnimFrameDelta		= MAX_ANIM_FRAME_DELTA_MED
		End
		
		LodOptions				= HIGH
			AllowMultipleModels		= ALLOW_MULTIPLE_MODELS_HIGH
			MaxRandomTextures		= MAX_RANDOM_TEXTURES_HIGH
			MaxRandomAnimations		= MAX_RANDOM_ANIMATIONS_HIGH
			MaxAnimFrameDelta		= MAX_ANIM_FRAME_DELTA_HIGH
		End

		WadingParticleSys = WaterRipplesTrail  ; used when the unit is wading in shallow water.

		ParticlesAttachedToAnimatedBones = yes

		
	;;====================== MODELS ================================================================
		;-----Spear-----
		DefaultModelConditionState
			Model			= CUBear_SKN
		End		
		
		;ROCK SKIN
		ModelConditionState = HERO
			Model 			= EURckBear_SKN
		End

		RandomTexture = CURdgBear.tga 0 CUBear.tga

	;;================== ANIMATIONS =================================================================
		#include "..\..\..\includes\beorningbearanimations.inc"		

	End
	
	Draw = W3DScriptedModelDraw DustEffects
	    DefaultModelConditionState
	      Model = None
	    End
	    IdleAnimationState
	    End
	    AnimationState = MOVING WADING
			ParticleSysBone = None FootstepSlash
	    End
	    AnimationState = MOVING ACCELERATE
			ParticleSysBone = None GenericSiegeTrailDust
	    End
	    AnimationState = MOVING DECELERATE
			ParticleSysBone = None GenericSiegeTrailDust
	    End
	    AnimationState = MOVING
	    End
	End

	; NOTE, PLEASE: If you are changing this unit in any way, you should consider changing 
	; GondorCavalryRiderless in FactionSubObject.ini

    #include "..\..\..\includes\StunDrawModuleMedium.inc"

	; ***DESIGN parameters ***
	Side 		= Elves
	EditorSorting 	= UNIT
	ThreatLevel 	= GANDALF_THREAT_LEVEL
	TransportSlotCount = TRANSPORTSLOTCOUNT_UNIT

	; Weapon Sets
	WeaponSet
		Conditions		= None 
		Weapon			= PRIMARY RadagastBearPaw
		AutoChooseSources	= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End

	ArmorSet
		Conditions      = None
		Armor           = ToughHeroArmor
		DamageFX        = NormalDamageFX
	End

	ArmorSet
		Conditions      = PLAYER_UPGRADE
		Armor           = RadagastBearArmor
		DamageFX        = NormalDamageFX
	End
	
	BountyValue		= GONDOR_GANDALFWHITE_BOUNTY_VALUE 
	
	VisionRange = VISION_HERO_STANDARD				
	ShroudClearingRange = SHROUD_CLEAR_HERO
	MaxVisionBonusPercent = 300%
	VisionBonusTestRadius = 200
	VisionBonusPercentPerFoot = 1.0%

	DisplayName		= OBJECT:Radagast
	CrushableLevel		= 2  					; What am I?:        0 = for infantry, 1 = for trees, 2 = general vehicles
	CrusherLevel		= 2
	CrusherLevel        		= 2				;//What can I crush?: 1 = infantry, 2 = trees, 3 = vehicles

	CrushWeapon			= BattleWagonCrush  
	MinCrushVelocityPercent		= 40				;// Has to be moving at at least 30% of full speed.
	CrushDecelerationPercent	= 3						; Lose 20 percent of max velocity when crushing.
	
	CrushKnockback 	= 40	;
	CrushZFactor 		= 1.0	;

	UseCrushAttack				= No
	ThreatLevel				= ELVEN_BEORNING_THREAT_LEVEL

	ShockwaveResistance 			= SHOCKWAVE_RESISTANCE_STRONG

	CommandSet 		= RadagastBearCommandSet
	CommandPoints 		= 50 					

  	; *** AUDIO Parameters ***;
  	VoiceSelect = NoSound
  	VoiceMove = NoSound
  	VoiceAttack = NoSound
  	VoiceFear = NoSound
  	VoiceGuard = NoSound
	;  SoundDie = NoSound
	;  SoundDieFire = NoSound
  	SoundStealthOn = NoSound
  	SoundStealthOff = NoSound
  
  	UnitSpecificSounds
    		VoiceGarrison         = NoSound
    		VoiceEnter            = NoSound
    		VoiceEnterHostile     = NoSound
    		VoiceGetHealed        = NoSound
  	End
	
	CrowdResponseKey = Elf

    	#include "..\..\..\Includes\StandardUnitEvaEvents.inc"

	ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_foo
		ModelCondition = Required:RAISING_FLAG			Excluded:DYING ENGAGED	Sound:EmotionMenGoodCompilationBFME1and2VoxTauntSinglesLoop
	End

	; *** ENGINEERING Parameters ***
 
	RadarPriority = UNIT
	ThingClass = CAVALRY_UNIT
	KindOf = PRELOAD HERO SELECTABLE CAN_CAST_REFLECTIONS CAVALRY SCORE
	
	Body = RespawnBody ModuleTag_RespawnBody
		CheerRadius 			= EMOTION_CHEER_RADIUS
		MaxHealth         		= RADAGAST_HEALTH	;BALANCE Eomer Health
		PermanentlyKilledByFilter	= NONE		;Who kills me permanently?
   		DodgePercent      		= HERO_DODGE_PERCENT
	End
	Behavior = RespawnUpdate ModuleTag_RespawnUpdate
;		DeathAnim				= STUNNED				;Model condition to play when killed-to-respawn
		DeathAnim				= DYING  				;Model condition to play when killed-to-respawn
		DeathFX				= FX_BoromirDieToRespawn	;FXList to play when killed-to-respawn
		DeathAnimationTime		= 4966 ;1133			;How long DeathAnim will take.
		InitialSpawnFX			= FX_BoromirInitialSpawn
		RespawnAnim				= LEVELED				;Animation to play when respawning.
		RespawnFX				= FX_BoromirRespawn		;FXList to play when respawning.
		RespawnAnimationTime		= 2000				;Time it takes for respawn to play.
		AutoRespawnAtObjectFilter	= NONE +CASTLE_KEEP		;Respawn at this location -- and at it's exit production point if possible.
		ButtonImage				= HIRadagast_res
		RespawnAsTemplate			= ElvenRadagast
		
		;RespawnEntries determine the ruleset for how a character can be revived. Some units may automatically respawn, others
		;may require a specific revive action performed on him. You can specify different values for each level... or use Level:Any
		RespawnRules =			AutoSpawn:No	Cost:3500		Time:60000		Health:100%		;DEFAULT VALUES	
	End
	
	#include "..\..\..\includes\CaptureBuilding.inc"
   	
	Behavior = AIUpdateInterface ModuleTag_03
		AutoAcquireEnemiesWhenIdle	= Yes ATTACK_BUILDINGS
		AILuaEventsList			= RohirrimFunctions
		AttackPriority			= AttackPriority_Cavalry
		BurningDeathTime		= BURNINGDEATH_DURATION_CAVALRY
	End
		
	LocomotorSet
		Locomotor = NormalHorseHordeMemberLocomotor
		Condition = SET_NORMAL 
		Speed     = NORMAL_MOUNTED_MED_MEMBER_SPEED
	End

	LocomotorSet
		Locomotor = NormalHorseHordeMemberLocomotor
		Condition = SET_COMBO
		Speed     = NORMAL_FOOT_FAST_MEMBER_SPEED
	End

	LocomotorSet
		Locomotor = BurningDeathLocomotorCavalry
		Condition = SET_BURNINGDEATH
		Speed	  = BURNINGDEATH_WANDERSPEED_CAVALRY
	End

	Behavior = PhysicsBehavior ModuleTag_04
		GravityMult = 1.0
		ShockStandingTime = 2533			; msec
	End
	
	Behavior = SquishCollide ModuleTag_06
		;nothing
	End
	
	; RohanRohirrim
	Behavior = HordeMemberCollide ModuleTag_HMC
		;nothing
	End

	Behavior = AutoHealBehavior ModuleTag_EntHealing
		StartsActive			= Yes
		HealingAmount			= HERO_HEAL_AMOUNT
		HealingDelay			= 1000
		StartHealingDelay		= HERO_HEAL_DELAY
		HealOnlyIfNotInCombat	= Yes
	End

	Behavior = SlowDeathBehavior ModuleTag_08
		DeathTypes 		= ALL -FADED
		SinkDelay 		= 3000
		SinkRate 		= 1.0     ; in Dist/Sec
		DestructionDelay 	= 15000
		;ProbabilityModifier 	= 33
		DeathFlags 		= DEATH_1 ; Tell model which death animation to play. Sets BOTH model condition and object status bits.
		Sound 			= INITIAL RohirrimVoiceDie
	End
	
  	Behavior = SlowDeathBehavior ModuleTag_FadeDeath
		DeathTypes 	= NONE +FADED
		FadeDelay 	= 0
		FadeTime 	= 4000
		DestructionDelay = 4000
        DeathFlags = DEATH_2
        FX = INITIAL FX_RohirrimAlliesUnsummon
	End
	
	;--------------------------- SHAPESHIFT HUMAN ---------------------------------------------------------------
 	Behavior = SpecialPowerModule ModuleTag_HumanToggleStarter                      
 		SpecialPowerTemplate		= SpecialAbilityShapeshiftOne
 		UpdateModuleStartsAttack	= Yes
 		StartsPaused				= No
		;InitiateSound				= FellBeastVoiceMove
 	End

	Behavior = ToggleMountedSpecialAbilityUpdate ModuleTag_HumanToggle
 		SpecialPowerTemplate    = SpecialAbilityShapeshiftOne
 		MountedTemplate			= ElvenRadagast
 		SynchronizeTimerOnSpecialPower = SpecialAbilityAlarHeal SpecialAbilityElvenWood SpecialAbilityEagleAllies SpecialAbilityHeroMode SpecialAbilityRadagastEarthquake SpecialAbilityElrondRestoration SpecialAbilityLightningStrike SpecialAbilityGimliHeroMode
 		UnpackTime              = 2000
 		PreparationTime         = 0			; none, cause we hop onto our mount in no time at all :)
 		PackTime                = 0 		; none, cause we hop onto our mount in no time at all :)
 		OpacityTarget			= .0		; How see-thru to be at peak of change
 		AwardXPForTriggering    = 0
 		IgnoreFacingCheck		= Yes
		;TriggerSound			= FellBeastVoiceMove
        UnpackingVariation      = 1
	End
	
	;--------------------------------- HARD SKIN -------------------------------------------------------------
	Behavior = ArmorUpgrade ArmorUpgradeModuleTag
		TriggeredBy = Upgrade_ObjectLevel3
	End

	;--------- MOUNTAIN SHIELD ---------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_ShieldEnable
		SpecialPowerTemplate 	= SpecialAbilityFakeLeadership2
		TriggeredBy 		= Upgrade_ObjectLevel5
	End
	Behavior = AttributeModifierAuraUpdate ModuleTag_FaramirLeadership
		StartsActive	= No ;If no, requires upgrade to turn on.
		BonusName		= MountainShield
		RefreshDelay	= 2500
		Range			= 200
		AntiCategory	= BUFF
		ObjectFilter	= GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
	End
	Behavior = SpecialPowerModule ModuleTag_TheodenLeadershipUpdate   
		SpecialPowerTemplate      = SpecialAbilityFakeLeadership2
		UpdateModuleStartsAttack  = No
		StartsPaused = Yes ;No
	End

	;---------------------------------- ROCK SKIN ---------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_IgniteEnable
		SpecialPowerTemplate 	= SpecialAbilityHeroMode
		ObeyRechageOnTrigger		= Yes
		TriggeredBy 		= Upgrade_ObjectLevel7
	End
  	Behavior = SpecialPowerModule ModuleTag_IgniteStarter                      
		SpecialPowerTemplate      = SpecialAbilityHeroMode
		UpdateModuleStartsAttack  = Yes
		StartsPaused 		= Yes
		;InitiateSound           = 
	End
	Behavior = HeroModeSpecialAbilityUpdate ModuleTag_IgniteUpdate   
		SpecialPowerTemplate    = SpecialAbilityHeroMode
		UnpackingVariation		= 2

		UnpackTime              = 1800 
		PackTime                = 1600

		AwardXPForTriggering    = 0
		
		HeroAttributeModifier = RockSkin
		HeroEffectDuration = 30000
	End
	
	;---------------------------------- EARTHQUAKE ---------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_EarthquakeEnable
		SpecialPowerTemplate 	= SpecialAbilityRadagastEarthquake
		ObeyRechageOnTrigger		= Yes
		TriggeredBy 		= Upgrade_ObjectLevel10
	End
	
	Behavior = OCLSpecialPower ModuleTag_Earthquake
		SpecialPowerTemplate = SpecialAbilityRadagastEarthquake
		OCL                  = OCL_SpellBookEarthquake
        	;TriggerFX			 = FX_ElvenAlliesSummon
		CreateLocation       = CREATE_AT_LOCATION
		StartsPaused 		= Yes
	End

	;--------------------------------------------------------------------------------------------------
	;--------------------------------------------------------------------------------------------------

    ;------------------------- HEAL -------------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_HealEnabler
		SpecialPowerTemplate	= SpecialAbilityAlarHeal
		ObeyRechageOnTrigger		= Yes
		TriggeredBy				= Upgrade_ObjectLevel3
	End
	
  	Behavior = PlayerHealSpecialPower ModuleTag_Heal
		SpecialPowerTemplate  = SpecialAbilityAlarHeal
		HealAffects			  = INFANTRY CAVALRY MONSTER MACHINE SHIP DOZER
		HealAmount			  = 0.8 ;1.0	; 0.5 = 50% of maximum health
		HealRadius			  = SPELL_HEAL_RADIUS_UNIT_SCAN
		HealFX				  = FX_SpellHealUnitHealBuff		;FX_DefaultUnitHealBuff
		; To replenish hordes a bit
		HealOCL               = OCL_HealSpellHordeReplenishPing
		StartsPaused		  	  = Yes
	End
	
	;------------------------- RESTORATION -------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_RestorationUnpause
		SpecialPowerTemplate		= SpecialAbilityElrondRestoration
		ObeyRechageOnTrigger		= Yes
		TriggeredBy					= Upgrade_ObjectLevel7
	End
	Behavior = SpecialPowerTimerRefreshSpecialPower ModuleTag_RestorationRefresh
		SpecialPowerTemplate		= SpecialAbilityElrondRestoration
		StartsPaused				= Yes
		UpdateModuleStartsAttack	= No
		AffectAllies				= Yes
		AttributeModifierRange		= 150
		AttributeModifierAffects	= ALL -ElvenElrond ALLIES
		SetModelCondition			= ModelConditionState:USER_1
		SetModelConditionTime		= 3.66
	End
  	Behavior = PlayerHealSpecialPower ModuleTag_RestorationHeal
		SpecialPowerTemplate		= SpecialAbilityElrondRestorationHeal
		HealAffects					= INFANTRY CAVALRY MONSTER
		HealAmount					= 0.8 ; percent of max health
		HealRadius					= 150
		HealFX						= FX_ElrondHealSpecialPower
	End
	
	;------------------------ MANWE'S FURY -------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_LightningEnabler
		SpecialPowerTemplate	= SpecialAbilityLightningStrike
		ObeyRechageOnTrigger		= Yes
		TriggeredBy				= Upgrade_ObjectLevel10
	End

	Behavior = SpecialPowerModule ModuleTag_LightningStrike                      
		SpecialPowerTemplate		= SpecialAbilityLightningStrike
		UpdateModuleStartsAttack	= Yes
		StartsPaused				= Yes
		InitiateSound				= WizardTowerLightningStrikeRumbleMS
	End

	Behavior = ArrowStormUpdate ModuleTag_ShootLightningBolts
		SpecialPowerTemplate    = SpecialAbilityLightningStrike
		StartAbilityRange       = ISENGARD_WIZARDSTOWER_LIGHTNING_RANGE
		CanShootEmptyGround		= Yes
		
		UnpackTime              = 2500	;// Pull out arrow
		PreparationTime         = 1		;// Quick shot
		PersistentPrepTime      = 500	;// looping the quick shot
		PackTime                = 1500	;// back to idle

		ApproachRequiresLOS     = No	;// required so that it doesn't shoot through walls
		AwardXPForTriggering    = 0
		
		;ActiveLoopSound			= GandalfLightningLoop  ;// Sound loops entire time ability is actively firing

		;//Specific to ArrowStorm
		WeaponTemplate  = ManweFuryLightningWeapon
		TargetRadius    = ISENGARD_WIZARDSTOWER_LIGHTNING_FIRE_RADIUS
		ShotsPerTarget  = 1
		ShotsPerBurst   = 1
		MaxShots        = ISENGARD_WIZARDSTOWER_LIGHTNING_NUMSHOTS  ;// will double up if run out of targets
	        
      End

	;----------------- PREDATOR -------------------------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_KnifeEnabler
		SpecialPowerTemplate = SpecialAbilityGimliHeroMode
		TriggeredBy = Upgrade_ObjectLevel10
		ObeyRechageOnTrigger		= Yes
	End

	Behavior = WeaponModeSpecialPowerUpdate ModuleTag_KnifeFighterPowerUpdate
		SpecialPowerTemplate	= SpecialAbilityGimliHeroMode
		Duration				= 30000												; Needs to match SpecialAbilityGimliHeroMode
		AttributeModifier		= Predator
		;LockWeaponSlot			= SECONDARY
;		WeaponSetFlags			= WEAPONSET_TOGGLE_1
		StartsPaused			= Yes
;		InitiateSound 			= DwarfZerkVoiceLeap		;this doesn't work
	End

	;---------SUMMON EAGLE-----------------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_UnpauseSummonDunedain
		SpecialPowerTemplate		= SpecialAbilityEagleAllies
		TriggeredBy					= Upgrade_ObjectLevel5
		ObeyRechageOnTrigger		= Yes
	End

	Behavior = OCLSpecialPower ModuleTag_SummonDunedainOCL
		SpecialPowerTemplate = SpecialAbilityEagleAllies
		OCL                  = OCL_SpawnEagles
		CreateLocation       = CREATE_ABOVE_LOCATION
		UpgradeName			 = Upgrade_ObjectLevel5
		SetModelCondition	 = ModelConditionState:USER_1
		StartsPaused 		= Yes
	End
	
	;--------- YAVANNA'S REBIRTH -----------------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_UnpauseElvenWood
		SpecialPowerTemplate		= SpecialAbilityElvenWood
		TriggeredBy					= Upgrade_ObjectLevel7
		ObeyRechageOnTrigger		= Yes
	End
	
	Behavior           = ElvenWoodSpecialPower ModuleTag_ElvenWood
		SpecialPowerTemplate	= SpecialAbilityElvenWood
		ElvenGroveObject		= ElvenGrove
		ElvenWoodRadius			= SPELLBOOK_TAINT_RADIUS
		ElvenWoodFX				= FX_ElvenWoodSpellFX
		ElvenWoodOCL			= OCL_RadagastWoodSeed
;		CreateLocation			= CREATE_AT_LOCATION
		StartsPaused 		= Yes
	End


	;-------------- ANIMAL COMPANIONS ----------------
	Behavior = QueueProductionExitUpdate ModuleTag_017
		UnitCreatePoint = X:-5.0 Y:-5.0 Z:0.0
		NaturalRallyPoint = X:5.0 Y:5.0 Z:0.0
		ExitDelay = STANDARD_HORDE_EXIT_DELAY
		PlacementViewAngle = 45
	End

	Behavior = SpawnBehavior ModuleTag_Spawn1
		TriggeredBy = Upgrade_ObjectLevel1
		SpawnNumber = 1
		InitialBurst = 1
		SpawnTemplateName = ElvenRadagastWolfCompanion
		SpawnReplaceDelay = 4500
		CanReclaimOrphans = Yes
	End

	Behavior = SpawnBehavior ModuleTag_Spawn2
		TriggeredBy = Upgrade_ObjectLevel3
		SpawnNumber = 1
		InitialBurst = 1
		SpawnTemplateName = ElvenRadagastWolfCompanion
		SpawnReplaceDelay = 4500
		CanReclaimOrphans = Yes
	End

	Behavior = SpawnBehavior ModuleTag_Spawn3
		TriggeredBy = Upgrade_ObjectLevel5
		SpawnNumber = 1
		InitialBurst = 1
		SpawnTemplateName = ElvenRadagastWolfCompanion
		SpawnReplaceDelay = 4500
		CanReclaimOrphans = Yes
	End

	;///////////////////
	; AISpecialPowers
	;///////////////////
	
	Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
		CommandButtonName = Command_SetStanceBattle
		SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
	End

	Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
		CommandButtonName = Command_SetStanceAggressive
		SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
	End

	Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
		CommandButtonName = Command_SetStanceHoldGround
		SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
	End

	Behavior = AISpecialPowerUpdate ToggleMountedAI
		CommandButtonName = Command_BeorningReturnShapeshift
		SpecialPowerAIType = AI_SPECIAL_POWER_TOGGLE_MOUNTED
	End

	// *** AUTO RESOLVE DATA *** 
	AutoResolveUnitType = AutoResolveUnit_Cavalry
	AutoResolveCombatChain = AutoResolve_CavalryCombatChain

	AutoResolveBody = AutoResolve_MordorAttackTrollBody

	AutoResolveArmor
		Armor = AutoResolve_MordorAttackTrollArmor
	End

	AutoResolveWeapon
		Weapon = AutoResolve_MordorAttackTrollWeapon
	End

	; *** AUTO RESOLVE DATA *** 
	AutoResolveUnitType = AutoResolveUnit_Hero
	AutoResolveCombatChain = AutoResolve_HeroCombatChain

	AutoResolveBody = AutoResolve_GandalfBody
	
	AutoResolveWeapon
		Weapon = AutoResolve_GandalfWeapon
	End
	AutoResolveArmor
		Armor = AutoResolve_GandalfArmor
	End
	
	Scale = 1.3
			
	Geometry = Box
	GeometryMajorRadius = 30.0
	GeometryMinorRadius = 17.0
	GeometryHeight = 44.8
	GeometryOffset = X:5.0 Y:0.0 Z:0.0
End