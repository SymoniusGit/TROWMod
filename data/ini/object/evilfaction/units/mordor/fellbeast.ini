;------------------------------------------------------------------------------
; Aka Nazgul, MordorNazgul, FlyingNazgul
Object MordorFellBeastInterface
	; *** ART Parameters ***

	;Scale = 2 ;1.3

	; This is required for garrisoned objects - please put in all objects.
	ButtonImage = HINazgul
    
    ; SelectPortrait for Heros is portrait behind skill buttons. HP = HeroPortrait.
	SelectPortrait = HPNazgul
	
	DescriptionStrategic = CONTROLBAR:LW_ToolTip_FellBeast
	
	ShockwaveResistance = SHOCKWAVE_RESISTANCE_ALWAYS

	Draw = W3DScriptedModelDraw ModuleTag_01
	    ExtraPublicBone = B_PASSENGER

	    OkToChangeModelColor = Yes
	    StaticModelLODMode = Yes

		DefaultModelConditionState
			Model = CUFellBst_SKN
			WeaponLaunchBone = PRIMARY BAT_TOER1
		End

		ModelConditionState = RIDER2
			Model = MUWchKngFB_SKN
		End

		ModelConditionState = RIDER3
			Model = KUAgnFllBst_SKN
		End

		IdleAnimationState
			StateName = Idle
			Animation = IDLA
				AnimationName = CUFellBst_SKL.CUFellBst_HVRA
				AnimationMode = LOOP
				AnimationBlendTime = 10
				AnimationSpeedFactorRange = 0.95 1.05
			End
		End

 		AnimationState	= BACKING_UP
   			StateName = backup
   			Animation = IDLA
   				AnimationName = CUFellBst_SKL.CUFellBst_HVRA
   				AnimationMode = LOOP
   				AnimationBlendTime = 10
				AnimationSpeedFactorRange = 0.95 1.05
   			End
   		End
   
   		AnimationState = DIVING
   			StateName = Diving
   			Animation = Diving
   				AnimationName = CUFellBst_SKL.CUFellBst_ATKD
   				AnimationMode = LOOP
   				AnimationBlendTime = 10
 				AnimationSpeedFactorRange = 0.95 1.05
  			End
   		End

		AnimationState = ABOUT_TO_HIT ; clawing
			StateName = Claw
			Animation = Claw
				AnimationName = CUFellBst_SKL.CUFellBst_ATKD
				AnimationMode = LOOP
				AnimationBlendTime = 10
			End
 	 		BeginScript
 				CurDrawableSetTransitionAnimState("Trans_Begin_Attacking") return 
 			EndScript
			
		End
		TransitionState = Trans_Begin_Attacking 
			Animation = Grab
				AnimationName = CUFellBst_SKL.CUFellBst_GRBA
				AnimationMode = ONCE
				AnimationBlendTime = 10
				AnimationSpeedFactorRange = 0.4 0.4
			End
		End



	    AnimationState  STUNNED SPECIAL_DAMAGED
			StateName =  STUNNED
			Animation = HitA
				AnimationName = CUFellBst_SKL.CUFellBst_ATKH
				AnimationMode = ONCE
				AnimationBlendTime = 6
			End
		End
	    AnimationState  STUNNED
			StateName =  STUNNED
			Animation = HitA
				AnimationName = CUFellBst_SKL.CUFellBst_HITA
				AnimationMode = ONCE
				AnimationBlendTime = 6
			End
		End

		AnimationState = SPECIAL_WEAPON_TWO					; Screech
			Animation
				AnimationName		= CUFellBst_SKL.CUFellBst_ATKA
				AnimationMode		= ONCE
				AnimationBlendTime	= 20
			End
			FXEvent					= Frame:30 Name:FX_FearBlast
		End

		AnimationState = SPECIAL_WEAPON_THREE					; Screech
			Animation
				AnimationName		= CUFellBst_SKL.CUFellBst_ATKA
				AnimationMode		= ONCE
				AnimationBlendTime	= 20
			End
			;FXEvent					= Frame:30 Name:FX_FearBlast
		End


		;--- HARD FLAPPING ------------------------
		AnimationState = CLIMBING
			StateName = Climbing
			Animation = Moving
				AnimationName = CUFellBst_SKL.CUFellBst_HVRB
				AnimationMode = LOOP
				AnimationBlendTime = 10
				AnimationSpeedFactorRange = 0.95 1.05
			End
		End
		AnimationState = FREEFALL
			StateName = Freefall
			Animation = Moving
				AnimationName = CUFellBst_SKL.CUFellBst_IDLA
				AnimationMode = LOOP
				AnimationBlendTime = 10
			End
		End

		AnimationState = MOVING SPECIAL_WEAPON_ONE
			StateName = Moving
			Animation = Moving
				AnimationName = CUFellBst_SKL.CUFellBst_ATKB
				AnimationMode = LOOP
				AnimationBlendTime = 10
			End
 	 		BeginScript
 				Prev = CurDrawablePrevAnimationState()
 				if Prev == "Idle"	then CurDrawableSetTransitionAnimState("Trans_Begin_Moving") return end
 				if Prev == "Climbing"	then CurDrawableSetTransitionAnimState("Trans_Begin_Moving") return end
 			EndScript
	    End
	
		AnimationState = MOVING
			StateName = Moving
			Animation = Moving
				AnimationName = CUFellBst_SKL.CUFellBst_FLYA
				AnimationMode = LOOP
				AnimationBlendTime = 10
				AnimationSpeedFactorRange = 0.9 1.1
			End
 	 		BeginScript
 				Prev = CurDrawablePrevAnimationState()
 				if Prev == "Idle"	then CurDrawableSetTransitionAnimState("Trans_Begin_Moving") return end
 				if Prev == "Climbing"	then CurDrawableSetTransitionAnimState("Trans_Begin_Moving") return end
 			EndScript
	    End

   	    TransitionState = Trans_Begin_Moving
   			Animation = Transition
   				AnimationName = CUFellBst_SKL.CUFellBst_HVRC
   				AnimationMode = ONCE
   				AnimationBlendTime = 6
   			End  
   		End

  		AnimationState = DYING
 			Animation = DyingA
				AnimationName = CUFellBst_SKL.CUFellBst_HVRC
  				AnimationMode = LOOP
  				AnimationBlendTime = 10
                AnimationSpeedFactorRange = 0.5 0.5
  			End
  			StateName = DYING
		End

            AnimationState = DYING DEATH_1
 			Animation = DyingA
				AnimationName = CUFellBst_SKL.CUFellBst_HVRC
  				AnimationMode = LOOP
  				AnimationBlendTime = 10
                AnimationSpeedFactorRange = 0.5 0.5
  			End
		End

            AnimationState = DYING DEATH_2
 			Animation = DyingA
				AnimationName = CUFellBst_SKL.CUFellBst_HVRC
  				AnimationMode = ONCE
  				AnimationBlendTime = 10
                AnimationSpeedFactorRange = 0.5 0.5
  			End
		End

		AnimationState = RUBBLE 
			Animation = RubbleDieF
				AnimationName = CUFellBst_SKL.CUFellBst_DIVA
				AnimationMode = ONCE
				AnimationBlendTime = 4
			End
		End
	    
	
;--- WING BLAST ----------------------------------------------------------------------------
		AnimationState			= SPECIAL_WEAPON_THREE				; wing blast
			StateName			= STATE_WingBlastLoop
			Animation
				AnimationName				= CUFELLBST_SKL.CUFELLBST_ATKA				AnimationMode				= LOOP
				AnimationSpeedFactorRange	= 0.9 0.9				; to match the weapon timing.
			End
			FXEvent	= Frame:6 Name:FX_WindBlast
 	 		BeginScript
 				Prev = CurDrawablePrevAnimationState()
 				if Prev ~= "TRANS_WingBlastStart" and Prev ~= "STATE_WingBlastLoop" then
 					CurDrawableSetTransitionAnimState("TRANS_WingBlastStart") end
 			EndScript
		End

   	    TransitionState = TRANS_WingBlastStart
   			Animation
   				AnimationName = CUFELLBST_SKL.CUFELLBST_ATKA
   				AnimationMode = ONCE
   			End  
   		End
   		
   		TransitionState = TRANS_WingBlastStop
   			Animation
   				AnimationName = CUFELLBST_SKL.CUFELLBST_GRBA
   				AnimationMode = ONCE
   			End  
   		End
End ; Draw

	; ***DESIGN parameters ***
	Side				= Mordor
	EditorSorting		= UNIT
	ThreatLevel			= FELL_BEAST_THREAT_LEVEL
	ThingClass			= LARGE_MONSTER
	TransportSlotCount	= TRANSPORTSLOTCOUNT_NOT_TRANSPORTABLE

	;//DisplayMeleeDamage = NAZGUL_PLOW_DAMAGE_INNER			

 	BuildCost         = 3500 ;NAZGUL_BUILDCOST				
 	BuildTime         = NAZGUL_BUILDTIME				

	WeaponSet
		Weapon				= PRIMARY		NazgulPlowAttack
		PreferredAgainst	= PRIMARY		STRUCTURE MACHINE HORDE

		Weapon				= SECONDARY		NazgulGrabAttack
		PreferredAgainst	= SECONDARY		INFANTRY THROWN_OBJECT CAVALRY

		Weapon				= TERTIARY		NazgulClawAttack
		OnlyAgainst			= TERTIARY		MONSTER
		
		ReadyStatusSharedWithinSet = Yes
	End
	
	ArmorSet
		Conditions      = None
		Armor           = NazgulFellBeastArmor ;NazgulArmor
		DamageFX        = FellBeastDamageFX
	End

	VisionRange			= VISION_FLIER
	ShroudClearingRange = SHROUD_CLEAR_FLIER
	DisplayName			= OBJECT:MordorFellBeast
	DisplayNameStrategic			= OBJECT:MordorFellBeast
	RecruitText			= CONTROLBAR:MordorFellBeastRecruit
	ReviveText			= CONTROLBAR:MordorFellBeastRevive
	Hotkey				= CONTROLBAR:MordorFellBeastHotkey
	RamPower			= 45
	RamZMult			= 0.5
	CrusherLevel		= 3  ;What can I crush?: 1 = infantry, 2 = trees, 3 = vehicles
	CrushKnockback		= 50
	CrushZFactor		= 1.0
	CommandSet			= FellBeastCommandSet		; CommandSet is overridden by Behavior Rider changes.
	CommandPoints		= 50


	; *** AUTO RESOLVE DATA *** 
	AutoResolveUnitType = AutoResolveUnit_Hero
	AutoResolveCombatChain = AutoResolve_HeroCombatChain
	
	AutoResolveBody = AutoResolve_NazgulBody
	
	AutoResolveWeapon
		Weapon = AutoResolve_NazgulWeapon
	End
	AutoResolveArmor
		Armor = AutoResolve_NazgulArmor
	End

	;AutoResolveLeadership = AutoResolve_NazgulBonus
	

	; *** AUDIO Parameters ***;

	VoiceAttack			= FellBeastVoiceAttackMS
	;VoiceCreated		= CampOrcCreateNazgul		;this conflicts with his respawn dialogue line -- rehooked to spawn FX
	;VoiceFullyCreated 	= CampOrcCreateNazgul		;this conflicts with his respawn dialogue line -- rehooked to spawn FX
	VoiceFear			= FellBeastAlert
	VoiceMove			= FellBeastVoiceMoveMS
	VoicePriority		= 76
	VoiceSelect			= FellBeastVoiceSelectMS
	VoiceGuard			= FellBeastVoiceMove

	SoundAmbient		= FellBeastVoxAmbientLoop
	SoundMoveStart		= FellBeastMoveStart
	SoundImpact			= ImpactHorse			;FellBeastDie
  
	;UnitSpecificSounds
	;End

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"

	ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
		MaxUpdateRangeCap = 800

		AnimationSound = Sound: FellBeastWingFlaps	Animation:CUFELLBST_SKL.CUFELLBST_IDLA Frames: 33

		AnimationSound = Sound: FellBeastWingFlaps	Animation:CUFELLBST_SKL.CUFELLBST_ATKB Frames: 1 24 65 87 112
		AnimationSound = Sound: FellBeastWingFlaps	Animation:CUFELLBST_SKL.CUFELLBST_ATKD Frames: 5

		AnimationSound = Sound: FellBeastEagleAttack	Animation:CUFELLBST_SKL.CUFELLBST_ATKD Frames: 10

		AnimationSound = Sound: FellBeastHurt		Animation:CUFELLBST_SKL.CUFELLBST_ATKH Frames: 0
		AnimationSound = Sound: FellBeastHurt		Animation:CUFELLBST_SKL.CUFELLBST_HITA Frames: 0
		AnimationSound = Sound: FellBeastWingFlaps	Animation:CUFELLBST_SKL.CUFELLBST_HITA Frames: 10

		AnimationSound = Sound: FellBeastWingFlaps	Animation:CUFELLBST_SKL.CUFELLBST_FLYA Frames: 5
		AnimationSound = Sound: FellBeastWingFlaps	Animation:CUFELLBST_SKL.CUFELLBST_HVRA Frames: 7
		AnimationSound = Sound: FellBeastWingFlapsShort	Animation:CUFELLBST_SKL.CUFELLBST_HVRB Frames: 3 
		AnimationSound = Sound: FellBeastWingFlapsShort	Animation:CUFELLBST_SKL.CUFELLBST_HVRC Frames: 5 32 
		AnimationSound = Sound: FellBeastWingFlaps	Animation:CUFELLBST_SKL.CUFELLBST_HVRC Frames: 62 103

		;-------- animation unused anymore -----------
		;AnimationSound = Sound: FellBeastEagleAttack	Animation:CUFELLBST_SKL.CUFELLBST_ATKE Frames: 20
		;AnimationSound = Sound: FellBeastWingFlaps	Animation:CUFELLBST_SKL.CUFELLBST_ATKA Frames: 1 24 46
		;AnimationSound = Sound: FellBeastWingFlaps	Animation:CUFELLBST_SKL.CUFELLBST_ATKC Frames: 16
		;AnimationSound = Sound: FellBeastWingFlaps	Animation:CUFELLBST_SKL.CUFELLBST_ATKE Frames: 7
		;AnimationSound = Sound: FellBeastWingFlaps	Animation:CUFELLBST_SKL.CUFELLBST_ATKF Frames: 7 
		;AnimationSound = Sound: FellBeastDie		Animation:CUFELLBST_SKL.CUFELLBST_DIEC Frames: 5
	End


	; *** ENGINEERING Parameters ***

	RadarPriority = UNIT
	KindOf = HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS SCORE NO_FREEWILL_ENTER SCARY MONSTER CANNOT_RETALIATE ARMY_SUMMARY
 
	Body = RespawnBody ModuleTag_02
		CheerRadius 	  = EMOTION_CHEER_RADIUS
		MaxHealth         = NAZGUL_HEALTH	;BALANCE FellBeast Health
;		MaxHealthDamaged  = 750
;		;RecoveryTime      = 15000
		DodgePercent     		= HERO_DODGE_PERCENT
		HealingBuffFx     = None
	End

	Behavior = AutoHealBehavior ModuleTag_FellbeastHealing
		StartsActive = Yes
		HealingAmount = NAZGUL_HEAL_AMOUNT
		HealingDelay = 1000
		StartHealingDelay = 15000
		HealOnlyIfNotInCombat = Yes
	End
	
	Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = Hero
    End
    
    Behavior = NotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
	End

	Behavior = RespawnUpdate ModuleTag_RespawnUpdate
		DeathAnim				= DYING
		;DeathFX				= FX_SarumanDieToRespawn	;FXList to play when killed-to-respawn
		;DeathAnimationTime		= 5500 ;1133			;How long DeathAnim will take.
		InitialSpawnFX			= FX_NazgulInitialSpawn
		RespawnFX				= FX_NazgulRespawn		;FXList to play when respawning.
		;RespawnAnim			= LEVELED				;Animation to play when respawning.
		;RespawnAnimationTime		= 2000				;Time it takes for respawn to play.
		AutoRespawnAtObjectFilter	= NONE +CASTLE_KEEP		;Respawn at this location -- and at it's exit production point if possible.
		ButtonImage				= HINazgul_res
		
		;RespawnEntries determine the ruleset for how a character can be revived. Some units may automatically respawn, others
		;may require a specific revive action performed on him. You can specify different values for each level... or use Level:Any
		RespawnRules =	AutoSpawn:No	Cost:2250	Time:120000	Health:100%		;DEFAULT VALUES
	End
	
 
	 Behavior = GiantBirdAIUpdate ModuleTag_GiantBirdAI
	    AutoAcquireEnemiesWhenIdle	=	Yes ATTACK_BUILDINGS
	    MoodAttackCheckRate			=	500
	    AILuaEventsList				=	FellBeastFunctions	
		FollowThroughDistance		=	200
		FollowThroughCheckStep		=	50
		FollowThroughGradient		=	1.0
		
		GrabTossTimeTrigger			=	2.5
		GrabTossHeightTrigger		=   100.0
		TossFX				= FX_DiebyFalling
		SpecialContactPoints		= Swoop
		
		AttackPriority = AttackPriority_FellBeast
	  End
	
	  LocomotorSet
	    Locomotor = FellBeastLocomotor ;BALANCE FellBeast
	    Condition = SET_NORMAL 
	    Speed     = 95  ;88
	  End
	  LocomotorSet
	    Locomotor = FellBeastLocomotor ; BALANCE FellBeast
	    Condition = SET_SUPERSONIC 
	    Speed     = 150 ;114
	  End
	  LocomotorSet
	    Locomotor = FellBeastLocomotor ; BALANCE FellBeast
	    Condition = SET_WANDER 
	    Speed     = 78
	  End
	  LocomotorSet
	    Locomotor = FellBeastSwoopLocomotor ; BALANCE FellBeast
	    Condition = SET_PANIC
	    Speed     = 160
	  End
	
	Behavior = PhysicsBehavior ModuleTag_04
		;;VehicleCrashesIntoBuildingWeaponTemplate = NazgulCrashingOnBuildingWeapon
		;;VehicleCrashesIntoNonBuildingWeaponTemplate = NazgulCrashingOnNonBuildingWeapon
	End
 
	Behavior = SpecialPowerModule ModuleTag_FellbeastLevelAttack                      
		SpecialPowerTemplate      = SpecialAbilityLevelAttack
		UpdateModuleStartsAttack  = Yes
		;InitiateSound           = 
	End

	Behavior = FellBeastSwoopPower ModuleTag_FellBeastSwoopPower ; special fellbeast swoop power
		SpecialPowerTemplate		= SpecialAbilityLevelAttack
		UnpackTime					= 1 ; hit the guy
		AwardXPForTriggering		= 0		
		StartAbilityRange			= 1000.0		
	End
  
	Behavior = TransportContain TransportContainModuleTag
		;Victim passenger
		ObjectStatusOfContained = UNSELECTABLE UNATTACKABLE
		PassengerFilter = ANY +INFANTRY +HULK +CAVALRY +GRAB_AND_DROP -HERO -PORTER -TROLL -MordorMountainTroll -MordorDrummerTroll -GoblinCaveTroll -GoblinCaveTroll_FromTrollLair -MordorCaveTroll_Summoned -MordorAttackTroll -MordorAttackTroll_Summoned
		Slots = 1
		ShowPips = No
		CollidePickup = No
		AllowEnemiesInside = Yes
		AllowNeutralInside = Yes
		AllowAlliesInside  = Yes
		DamagePercentToUnits = 0%
		PassengerBonePrefix = PassengerBone:B_PASSENGER       KindOf:GRAB_AND_DROP
		EjectPassengersOnDeath = No ;Let RiderChangeContain handle this
		
		GrabWeapon = FellbeastGrabWeapon ; fire this weapon when fellbeast grabs a victim
		FireGrabWeaponOnVictim = No
		
		ReleaseSnappyness = 0.05 ; 1.0 is very snappy, 0.0 is very loose
		
	End

	Behavior = SlowDeathBehavior ModuleTag_SlowDeath
		DeathTypes			= ALL -FADED
		DestructionDelay	= 500
		ShadowWhenDead		= No
		Sound				= INITIAL FellBeastDie
		FX					= INITIAL FX_FellBeastDeath
	End

	Behavior = SlowDeathBehavior ModuleTag_SlowDeathFaded
		DeathTypes			= NONE +FADED
		DestructionDelay	= 0
		FadeTime			= 1000
		FadeDelay			= 100
		ShadowWhenDead		= No
	End

	Behavior = SquishCollide ModuleTag_06
		;nothing
	End
 
	;;; AUTO ABILITY MODULE ;;;
	Behavior = AutoAbilityBehavior ModuleTag_AutoAbilityBehavior
	End	
	
	;///////////////////
	; AISpecialPowers
	;///////////////////
	
	Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
		CommandButtonName = Command_SetStanceBattle
		SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
	End

	Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
		CommandButtonName = Command_SetStanceAggressive
		SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
	End

	Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
		CommandButtonName = Command_SetStanceHoldGround
		SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
	End

	
	Behavior = AISpecialPowerUpdate ScreechAI
		CommandButtonName = Command_SpecialAbilityScreech
		SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
	End
	
	FormationPreviewDecal 
        	Texture = FPflyingUnitDecal
        	Width = 128
        	Height = 128
    	End

	Geometry			= CYLINDER
	GeometryMajorRadius = 39.0
	GeometryHeight		= 40.0
	GeometryOffset		= X:0 Y:0 Z:-10
	GeometryIsSmall		= No
	Shadow				= SHADOW_VOLUME_NON_SELF_3	; volumetric shadow that doesn't cast onto all objects using SHADOW_VOLUME_NON_SELF_3
	ShadowSunAngle		= 89						; clamp the angle so shadow casts straight down.
	Scale				= 0.80
End

;--------------------------------------------------------------------

ChildObject MordorFellBeast MordorFellBeastInterface

	Scale = 1.2

 	;--------- SCREECH -----------------------------------------------------------------------------------
 	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_BlackRiderScreechEnabler
		SpecialPowerTemplate = SpecialAbilityScreech
		TriggeredBy = Upgrade_BlackRiderNazgulScreech
	End
	Behavior = SpecialPowerModule ModuleTag_BlackRiderScreech                      
		SpecialPowerTemplate		= SpecialAbilityScreech
		UpdateModuleStartsAttack	= Yes
		StartsPaused			= Yes
		TriggerFX				= FX_FearBlast
	End
	Behavior = SpecialAbilityUpdate ModuleTag_BlackRiderScreechSAUpdate  
		SpecialPowerTemplate		= SpecialAbilityScreech
		UnpackTime					= 0  
		AwardXPForTriggering		= 0		
		TriggerSound				= NazgulScreech
		Instant						= Yes
		EffectRange					= 180
	End	

	Behavior = RespawnUpdate ModuleTag_RespawnUpdate
		DeathAnim					= DYING
		DeathFX						= FX_NazgulOnFellbeastDieToRespawn	;FXList to play when killed-to-respawn
		;DeathAnimationTime			= 5500 ;1133						;How long DeathAnim will take.
		InitialSpawnFX				= FX_NazgulInitialSpawn
		RespawnFX					= FX_NazgulRespawn					;FXList to play when respawning.
		;RespawnAnim				= LEVELED							;Animation to play when respawning.
		;RespawnAnimationTime		= 2000								;Time it takes for respawn to play.
		AutoRespawnAtObjectFilter	= NONE +CASTLE_KEEP					;Respawn at this location -- and at it's exit production point if possible.
		ButtonImage					= HINazgul_res
		
		;RespawnEntries determine the ruleset for how a character can be revived. Some units may automatically respawn, others
		;may require a specific revive action performed on him. You can specify different values for each level... or use Level:Any
		RespawnRules =	AutoSpawn:No	Cost:2250	Time:120000	Health:100%		;DEFAULT VALUES
		End

	EvaEventDieOwner 			= NazgulDie		;Eva event to trigger on unit's death. NOTICE THAT this is only for permanent deaths
End

;--------------------------------------------------------------------

ChildObject MordorWitchKingOnFellBeast MordorFellBeastInterface		;Real witchking

	Scale = 1.2	

    ; SelectPortrait for Heros is portrait behind skill buttons. HP = HeroPortrait.
	SelectPortrait = HPWitchKing
	
	DisplayName			= OBJECT:MordorWitchKingOnFellBeast
	DisplayNameStrategic = OBJECT:MordorWitchKingOnFellBeast
	RecruitText			= CONTROLBAR:MordorWitchKingOnFellBeastRecruit
	ReviveText			= CONTROLBAR:MordorWitchKingOnFellBeastRevive
	Hotkey				= CONTROLBAR:MordorWitchKingOnFellBeastHotkey
    
    ; ButtonImage for Heros is button image on Hero Select UI to select hero. HI = HeroIcon or HeroImage.
    	ButtonImage			= HIWitchKing
        
    	CommandSet			= MordorWitchKingRidingFellBeastCommandSet
	BuildCost			= WITCHKING_ON_FELLBEAST_BUILDCOST		
	BuildTime			= WITCHKING_ON_FELLBEAST_BUILDTIME		
	CommandPoints		= WITCHKING_COMMAND_POINTS

	

	;--- AUDIO Parameters ---

	SoundMoveStart		= NoSound

	;-------
	
	ArmorSet
		Conditions      = None
		Armor           = WitchKingFellBeastArmor ;NazgulArmor
		DamageFX        = FellBeastDamageFX
	End
		

	Body = RespawnBody ModuleTag_02
		CheerRadius 	  = EMOTION_CHEER_RADIUS
		MaxHealth         = WITCHKING_ON_FELLBEAST_HEALTH			
		HealingBuffFx     = None
		DodgePercent     		= HERO_DODGE_PERCENT
	End

	Behavior = RespawnUpdate ModuleTag_RespawnUpdate
		DeathAnim					= DYING
		DeathFX						= FX_WitchKingDieToRespawn	;FXList to play when killed-to-respawn
		;DeathAnimationTime			= 5500 ;1133				;How long DeathAnim will take.
		InitialSpawnFX				= FX_WitchKingInitialSpawn
		RespawnFX					= FX_WitchKingRespawn		;FXList to play when respawning.
		;RespawnAnim				= LEVELED					;Animation to play when respawning.
		;RespawnAnimationTime		= 2000						;Time it takes for respawn to play.
		AutoRespawnAtObjectFilter	= NONE +CASTLE_KEEP			;Respawn at this location -- and at it's exit production point if possible.
		ButtonImage					= HIWitchKing_res
		
		;RespawnEntries determine the ruleset for how a character can be revived. Some units may automatically respawn, others
		;may require a specific revive action performed on him. You can specify different values for each level... or use Level:Any
		RespawnRules =	AutoSpawn:No	Cost:3750	Time:120000	Health:100%		;DEFAULT VALUES
		End

	EvaEventDieOwner 			= WitchKingDie		;Eva event to trigger on unit's death. NOTICE THAT this is only for permanent deaths

	Behavior = TransportContain TransportContainModuleTag
		
		;Victim passenger
		ObjectStatusOfContained = UNSELECTABLE UNATTACKABLE
		PassengerFilter = ANY +INFANTRY +HULK +CAVALRY +GRAB_AND_DROP -HERO -PORTER
		Slots = 1
	
		;Standard TransportContain stuff
		ShowPips = No
		CollidePickup = No
		AllowEnemiesInside = Yes
		AllowNeutralInside = Yes
		AllowAlliesInside  = Yes
		DamagePercentToUnits = 0%
		PassengerBonePrefix = PassengerBone:B_PASSENGER       KindOf:GRAB_AND_DROP
		EjectPassengersOnDeath = No
		
		GrabWeapon = FellbeastGrabWeapon ; fire this weapon when fellbeast grabs a victim
		FireGrabWeaponOnVictim = No
	End

	;------- LEADERSHIP --------------------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_WillOfSauronEnabler
		SpecialPowerTemplate = SpecialAbilityFakeLeadership2
		;TriggeredBy = Upgrade_ObjectLevel2
	End
	Behavior = AttributeModifierAuraUpdate ModuleTag_WillOfSauron
		StartsActive		= Yes ;No ;If no, requires upgrade to turn on.
		BonusName		= GenericHeroLeadership
		;TriggeredBy		= Upgrade_ObjectLevel2
		RefreshDelay		= 2000
		Range			= 200
		AntiCategory	= BUFF
		ObjectFilter		= GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
	End
	Behavior = SpecialPowerModule ModuleTag_WillOfSauronUpdate   
		SpecialPowerTemplate      = SpecialAbilityFakeLeadership2
		UpdateModuleStartsAttack  = No
		StartsPaused = Yes
	End
	
	;---------DISMOUNT------------------------------------------------------------------------
 	Behavior = SpecialPowerModule ModuleTag_DismountStarter
 		SpecialPowerTemplate		= SpecialAbilityToggleMountedFromFellBeast
 		UpdateModuleStartsAttack	= Yes
 		StartsPaused				= No
		InitiateSound				= FellBeastVoiceMove
 	End
	Behavior = ToggleMountedSpecialAbilityUpdate ModuleTag_Dismount
 		SpecialPowerTemplate    = SpecialAbilityToggleMountedFromFellBeast
 		StartAbilityRange		= 50.0									; pretty small so we are forced to the right place.
 		MountedTemplate			= MordorWitchKing                         
 		SynchronizeTimerOnSpecialPower = SpecialAbilityCurseEnemy SpecialAbilityScreech SpecialAbilityWitchKingHourM
 		UnpackTime              = 0
 		PreparationTime         = 1  
; 		PersistentPrepTime      = 250
 		PackTime                = 0
 		OpacityTarget			= 1										; How see-thru to be at peak of change
 		AwardXPForTriggering    = 0
 		IgnoreFacingCheck		= Yes
	End

	;---------SCREECH------------------------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_ScreechUnPause
		SpecialPowerTemplate		= SpecialAbilityScreech
		TriggeredBy					= Upgrade_Screech
		ObeyRechageOnTrigger		= Yes
	End
	Behavior = SpecialPowerModule ModuleTag_Screech                      
		SpecialPowerTemplate		= SpecialAbilityScreech
		UpdateModuleStartsAttack	= Yes
		StartsPaused				= Yes
	End
	Behavior = SpecialAbilityUpdate ModuleTag_ScreechUpdate  
		SpecialPowerTemplate		= SpecialAbilityScreech
		UnpackTime					= 1
		AwardXPForTriggering		= 0
		TriggerSound				= WitchKingScreechMS
		EffectRange					= 180
		PreparationTime				= 1
		PackTime					= 3000
		CustomAnimAndDuration		= AnimState:SPECIAL_WEAPON_TWO AnimTime:3000
	End	
	
	;---------DREAD VISAGE------------------------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_DreadVisage
		SpecialPowerTemplate		= SpecialAbilityFakeLeadership
		TriggeredBy					= Upgrade_DreadVisage
	End
	Behavior = SpecialPowerModule ModuleTag_DreadVisageUpdate
		SpecialPowerTemplate		= SpecialAbilityFakeLeadership
		UpdateModuleStartsAttack	= Yes
		StartsPaused				= Yes
	End
	Behavior = AttributeModifierAuraUpdate ModuleTag_DreadVisageAura
		StartsActive	= No														;If no, requires upgrade to turn on.
		TriggeredBy		= Upgrade_DreadVisage
		RefreshDelay	= 2000
		Range			= WITCHKING_DREADVISAGE_EFFECT_RADIUS_MOUNTED
		TargetEnemy		= Yes
		AntiCategory	= LEADERSHIP BUFF
		BonusName		= GenericDebuff
		ObjectFilter	= ANY +INFANTRY +CAVALRY -STRUCTURE -BASE_FOUNDATION  -HERO -HORDE
	End
	Behavior = RadiateFearUpdate ModuleTag_DreadVisageFear
		InitiallyActive						= No
		TriggeredBy							= Upgrade_DreadVisage
		WhichSpecialPower					= 1
		GenerateFear						= Yes
		EmotionPulseRadius					= WITCHKING_DREADVISAGE_EFFECT_RADIUS_MOUNTED
		EmotionPulseInterval				= 2000
	End

	;-----WING BLAST---------------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_WingBlastUnpause
		SpecialPowerTemplate		= SpecialAbilityWKMorgulWing
		TriggeredBy					= Upgrade_ObjectLevel3
	End

	Behavior = SpecialPowerModule ModuleTag_WingBlastStarter
		SpecialPowerTemplate		= SpecialAbilityWKMorgulWing
		UpdateModuleStartsAttack	= Yes
		StartsPaused			= Yes
		InitiateSound			= DrogothVoxWingBlast
	End

	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_WingBlastUpdate
		SpecialPowerTemplate    = SpecialAbilityWKMorgulWing
		UnpackTime              = 2000												; time before the first flap
		PreparationTime			= 1													; *needs* to be something non-zero
		PackTime                = 1000
		PersistentPrepTime		= 900												; time between flaps, can't get much of a lower value than this.
		PersistentCount			= 20	; Total timing: this * PersistentPrepTime			; Change the anim speed to get a better match.
		AwardXPForTriggering    = 0
		StartAbilityRange		= 1.0	;please don't make this zero
										;zero makes the AI that controls this power sad
		SpecialWeapon			= WKWingBlast
		WhichSpecialWeapon		= 3						; sets SPECIAL_WEAPON_THREE
		;SkipContinue			= Yes
	End	
	
	;---------HOUR OF THE WITCH KING---------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_HOFTWEnabler
		SpecialPowerTemplate		= SpecialAbilityCurseEnemy
		TriggeredBy					= Upgrade_HourOfTheWitchKing
		ObeyRechageOnTrigger		= Yes
	End
	Behavior = SpecialPowerModule ModuleTag_HOFTW
		SpecialPowerTemplate		= SpecialAbilityCurseEnemy
		StartsPaused				= Yes
		UpdateModuleStartsAttack	= Yes
		InitiateSound				= FellBeastVoiceAttack
	End
 	Behavior = CurseSpecialPower ModuleTag_HOFTWUPdate
        SpecialPowerTemplate		= SpecialAbilityCurseEnemy

	    CursePercentage				= 100.0% //Curse the target's power by this amount (will not exceed maximum charge time)

		StartAbilityRange			= 200.0
		
		CursedFX					= FX_SarumanDominateTargets
		TriggerFX					= FX_CreateaHeroCurse
		UnpackTime					= 2000
		PreparationTime				= 1000
		FreezeAfterTriggerDuration	= 2500 ; Hold AI for this long after we fire.
    End	

	;---------HOUR OF THE WITCH KING NEW---------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_MightyRageStarter
		SpecialPowerTemplate			= SpecialAbilityWitchKingHourM
		TriggeredBy						= Upgrade_HourOfTheWitchKing
		ObeyRechageOnTrigger		= Yes
	End
	Behavior = SpecialPowerModule ModuleTag_DainMightyRageDummy
		SpecialPowerTemplate			= SpecialAbilityWitchKingHourM
		StartsPaused					= No;Yes
		UpdateModuleStartsAttack		= Yes
	End
	
	Behavior = ActivateModuleSpecialPower ModuleTag_CloseTheGap
		SpecialPowerTemplate			= SpecialAbilityWitchKingHourM
		StartAbilityRange				= 200
		TriggerSpecialPower				= ModuleTag_HOFTW				TARGETPOS
		TriggerSpecialPower				= ModuleTag_WizardBlastStarter	TARGETPOS
		;TriggerSpecialPower				= ModuleTag_MightyRageDebuff		TARGETPOS
		;TriggerSpecialPower				= ModuleTag_MightyRageSelfBuff	TARGETPOS
	End

	;;; WIZARD BLAST SPECIAL POWER ;;;	
	Behavior = SpecialPowerModule ModuleTag_WizardBlastStarter							
		SpecialPowerTemplate		= SpecialPowerTelekeneticPush
		UpdateModuleStartsAttack	= Yes
		InitiateSound			= SarumanVoiceAttackWizardBlast
	End	

	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_WizardBlastUpdate
		SpecialPowerTemplate		= SpecialPowerTelekeneticPush
		WhichSpecialWeapon		    = 3 ;
		SkipContinue				= Yes
		UnpackTime					= 1000
		PreparationTime				= 1   
		;PersistentPrepTime			= 1000
		;PackTime					= 100
		
		AwardXPForTriggering		= 0
		StartAbilityRange			= 80.0
		MustFinishAbility			= Yes
		SpecialWeapon				= WitchKingWizardBlast
	End

	Behavior = ModelConditionUpgrade ModuleTag_MakeUsAWitchKing
		TriggeredBy			= Upgrade_MordorFaction
		AddConditionFlags	= RIDER2
		Permanent			= Yes
	End


	; *** AUTO RESOLVE DATA *** 
	AutoResolveUnitType = AutoResolveUnit_Hero
	AutoResolveCombatChain = AutoResolve_HeroCombatChain

	AutoResolveBody = AutoResolve_WitchKingBody
	
	AutoResolveArmor
		Armor = AutoResolve_WitchKingArmor
	End

	AutoResolveWeapon
		Weapon = AutoResolve_WitchKingWeapon
	End
	
	;AutoResolveLeadership = AutoResolve_MouthOfSauronBonus

	;///////////////////
	; AISpecialPowers
	;///////////////////
	
	Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
		CommandButtonName = Command_SetStanceBattle
		SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
	End

	Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
		CommandButtonName = Command_SetStanceAggressive
		SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
	End

	Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
		CommandButtonName = Command_SetStanceHoldGround
		SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
	End

	
	Behavior = AISpecialPowerUpdate ToggleMountedAI
		CommandButtonName = Command_WitchKingToggleMounted
		SpecialPowerAIType = AI_SPECIAL_POWER_TOGGLE_MOUNTED
	End
	
	Behavior = AISpecialPowerUpdate ScreechAI
		CommandButtonName = Command_SpecialAbilityScreechWitchKing
		SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
	End
	
	Behavior = AISpecialPowerUpdate HourOfTheWitchKingAI
		CommandButtonName = Command_HourOfTheWitchKing
		SpecialPowerAIType = AI_SPECIAL_POWER_ENEMY_TYPE_KILLER
	End	
End

;--------------------------------------------------------------------

ChildObject KhamulFellBeast MordorFellBeastInterface

	Scale = 1.2

	DisplayName		= OBJECT:MordorKhamul
	DisplayNameStrategic		= OBJECT:MordorKhamul
	RecruitText		= CONTROLBAR:MordorKhamulRecruit
	ReviveText		= CONTROLBAR:MordorKhamulRevive
	Hotkey			= CONTROLBAR:MordorKhamulHotkey

	CommandSet		= KhamulFellBeastCommandSet				; CommandSet is overridden by Behavior Rider changes.


	Body = RespawnBody ModuleTag_02
		CheerRadius 	  = EMOTION_CHEER_RADIUS
		MaxHealth         = 7000	;BALANCE FellBeast Health
;		MaxHealthDamaged  = 750
;		;RecoveryTime      = 15000
		DodgePercent     		= HERO_DODGE_PERCENT
		HealingBuffFx     = None
	End

	Behavior = RespawnUpdate ModuleTag_RespawnUpdate
		DeathAnim			= DYING
		DeathFX				= FX_NazgulOnFellbeastDieToRespawn		; FXList to play when killed-to-respawn
		;DeathAnimationTime		= 5500 ;1133					; How long DeathAnim will take.
		InitialSpawnFX			= FX_NazgulInitialSpawn
		RespawnFX			= FX_NazgulRespawn				; FXList to play when respawning.
		;RespawnAnim			= LEVELED					; Animation to play when respawning.
		;RespawnAnimationTime		= 2000						; Time it takes for respawn to play.
		AutoRespawnAtObjectFilter	= NONE +CASTLE_KEEP				; Respawn at this location -- and at it's exit production point if possible.
		ButtonImage			= HINazgul_res
		
		;RespawnEntries determine the ruleset for how a character can be revived. Some units may automatically respawn, others
		;may require a specific revive action performed on him. You can specify different values for each level... or use Level:Any
		RespawnRules =	AutoSpawn:No	Cost:2250	Time:120000	Health:100%	; DEFAULT VALUES
		End

	EvaEventDieOwner 			= NazgulDie					; Eva event to trigger on unit's death. NOTICE THAT this is only for permanent deaths

	;---------DISMOUNT------------------------------------------------------------------------
 	Behavior = SpecialPowerModule ModuleTag_KhamulDismountStarter
 		SpecialPowerTemplate		= SpecialAbilityToggleMountedFromFellBeast
 		UpdateModuleStartsAttack	= Yes
 		StartsPaused			= No
		InitiateSound			= FellBeastVoiceMove
 	End
	Behavior = ToggleMountedSpecialAbilityUpdate ModuleTag_KhamulDismount
 		SpecialPowerTemplate    	= SpecialAbilityToggleMountedFromFellBeast
 		StartAbilityRange		= 50.0						; pretty small so we are forced to the right place.
 		MountedTemplate			= KhamulMounted
 		SynchronizeTimerOnSpecialPower 	= SpecialAbilityBlackRiderMorgulBlade SpecialAbilityScreech
 		UnpackTime              	= 0
 		PreparationTime         	= 1  
; 		PersistentPrepTime      	= 250
 		PackTime                	= 0
 		OpacityTarget			= 1						; How see-thru to be at peak of change
 		AwardXPForTriggering    	= 0
 		IgnoreFacingCheck		= Yes
	End

	Behavior = AISpecialPowerUpdate ToggleMountedAI
		CommandButtonName = Command_KhamulToggleMounted
		SpecialPowerAIType = AI_SPECIAL_POWER_TOGGLE_MOUNTED
	End
	;--------- MORGUL BLADE -----------------------------------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_BlackRiderMorgulBlade
		SpecialPowerTemplate = SpecialAbilityBlackRiderMorgulBlade
		TriggeredBy = Upgrade_BlackRiderMorgulBlade
	End
	Behavior = SpecialPowerModule ModuleTag_BlackRiderMorgulBladeStarter
		SpecialPowerTemplate		= SpecialAbilityBlackRiderMorgulBlade
		UpdateModuleStartsAttack	= Yes
		StartsPaused				= Yes
		InitiateSound				= FellBeastVoiceAttack		;LurtzVoiceAttackCripplingStrike
	End
	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_BlackRiderMorgulBladeUpdate
		SpecialPowerTemplate    = SpecialAbilityBlackRiderMorgulBlade
		SkipContinue			= Yes

		UnpackTime				= 250
		PreparationTime			= 1
		PersistentPrepTime		= 500
		PackTime				= 100
		
		AwardXPForTriggering	= 0		
		StartAbilityRange		= 15.0
		
		SpecialWeapon			= EvilMenBlackRiderMorgulBlade
		WhichSpecialWeapon		= 1
	End
	Behavior = AutoAbilityBehavior ModuleTag_MorgulBladeAutoAbility
		SpecialAbility	= SpecialAbilityBlackRiderMorgulBlade
		ForbiddenStatus = INSIDE_GARRISON
		AllowSelf		= No
		Query			= 1 MORGULBLADE_OBJECT_FILTER
	End
	
	Behavior = NotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
	End

	; Generic auto ability.
	Behavior = AutoAbilityBehavior ModuleTag_AutoAbilityBehavior
	End
	;--------- DREAD VISAGE -----------------------------------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_BlackRiderDreadVisage
		SpecialPowerTemplate = SpecialAbilityFakeLeadership
		TriggeredBy = Upgrade_BlackRiderDreadVisage
	End
	Behavior = SpecialPowerModule ModuleTag_BlackRiderDreadVisageUpdate
		SpecialPowerTemplate      = SpecialAbilityFakeLeadership
		UpdateModuleStartsAttack  = Yes
		StartsPaused = Yes
	End
	Behavior = AttributeModifierAuraUpdate ModuleTag_DreadVisage
		StartsActive		= No ;If no, requires upgrade to turn on.
		BonusName		= GenericDebuff
		TriggeredBy		= Upgrade_BlackRiderDreadVisage
		RefreshDelay	= 2000
		Range			= 200
		TargetEnemy		= Yes
		AntiCategory	= LEADERSHIP BUFF ; This means cancel all previous leadership bonuses
		ObjectFilter	= ANY +INFANTRY +CAVALRY -STRUCTURE -BASE_FOUNDATION -HERO -HORDE
	End
	Behavior = ModelConditionUpgrade ModuleTag_DreadVisageModelCondition
		TriggeredBy			= Upgrade_BlackRiderDreadVisage
		AddConditionFlags	= USER_3
	End
	
	Behavior = RadiateFearUpdate ModuleTag_DreadVisageFear
		InitiallyActive						= No
		TriggeredBy							= Upgrade_BlackRiderDreadVisage
		WhichSpecialPower					= 1
		GenerateTerror						= No
		GenerateFear			= Yes
		EmotionPulseRadius					= 100
		EmotionPulseInterval				= 1000
	End

	;-----WING BLAST---------------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_WingBlastUnpause
		SpecialPowerTemplate		= SpecialAbilityMorgulWing
		TriggeredBy					= Upgrade_ObjectLevel3
	End

	Behavior = SpecialPowerModule ModuleTag_WingBlastStarter
		SpecialPowerTemplate		= SpecialAbilityMorgulWing
		UpdateModuleStartsAttack	= Yes
		StartsPaused			= Yes
		InitiateSound			= DrogothVoxWingBlast
	End

	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_WingBlastUpdate
		SpecialPowerTemplate    = SpecialAbilityMorgulWing
		UnpackTime              = 2000												; time before the first flap
		PreparationTime			= 1													; *needs* to be something non-zero
		PackTime                = 1000
		PersistentPrepTime		= 900												; time between flaps, can't get much of a lower value than this.
		PersistentCount			= 20	; Total timing: this * PersistentPrepTime			; Change the anim speed to get a better match.
		AwardXPForTriggering    = 0
		StartAbilityRange		= 1.0	;please don't make this zero
										;zero makes the AI that controls this power sad
		SpecialWeapon			= DrogothWingBlast
		WhichSpecialWeapon		= 3						; sets SPECIAL_WEAPON_THREE
		;SkipContinue			= Yes
	End	

	;--------- SCREECH -----------------------------------------------------------------------------------
 	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_BlackRiderScreechEnabler
		SpecialPowerTemplate = SpecialAbilityScreech
		TriggeredBy = Upgrade_BlackRiderNazgulScreech
	End
	Behavior = SpecialPowerModule ModuleTag_BlackRiderScreech                      
		SpecialPowerTemplate		= SpecialAbilityScreech
		UpdateModuleStartsAttack	= Yes
		StartsPaused			= Yes
		TriggerFX				= FX_FearBlast
	End
	Behavior = SpecialAbilityUpdate ModuleTag_BlackRiderScreechSAUpdate  
		SpecialPowerTemplate		= SpecialAbilityScreech
		UnpackTime					= 0  
		AwardXPForTriggering		= 0		
		TriggerSound				= NazgulScreech
		Instant						= Yes
		EffectRange					= 180
	End

End

;--------------------------------------------------------------------
ChildObject MorgomirFellBeast MordorFellBeastInterface

	Scale = 1.2

	DisplayName		= OBJECT:MordorMorgomir
	DisplayNameStrategic		= OBJECT:MordorMorgomir
	RecruitText		= CONTROLBAR:MordorMorgomirRecruit
	ReviveText		= CONTROLBAR:MordorMorgomirRevive
	Hotkey			= CONTROLBAR:MordorMorgomirHotkey

	CommandSet		= KhamulFellBeastCommandSet					; CommandSet is overridden by Behavior Rider changes.

	Body = RespawnBody ModuleTag_02
		CheerRadius 	  = EMOTION_CHEER_RADIUS
		MaxHealth         = 6000	;BALANCE FellBeast Health
;		MaxHealthDamaged  = 750
;		;RecoveryTime      = 15000
		HealingBuffFx     = None
		DodgePercent     		= HERO_DODGE_PERCENT
	End

	Behavior = RespawnUpdate ModuleTag_RespawnUpdate
		DeathAnim			= DYING
		DeathFX				= FX_NazgulOnFellbeastDieToRespawn		; FXList to play when killed-to-respawn
		;DeathAnimationTime		= 5500 		;1133				; How long DeathAnim will take.
		InitialSpawnFX			= FX_NazgulInitialSpawn
		RespawnFX			= FX_NazgulRespawn				; FXList to play when respawning.
		;RespawnAnim			= LEVELED					; Animation to play when respawning.
		;RespawnAnimationTime		= 2000						; Time it takes for respawn to play.
		AutoRespawnAtObjectFilter	= NONE +CASTLE_KEEP				; Respawn at this location -- and at it's exit production point if possible.
		ButtonImage			= HINazgul_res
		
		;RespawnEntries determine the ruleset for how a character can be revived. Some units may automatically respawn, others
		;may require a specific revive action performed on him. You can specify different values for each level... or use Level:Any
		RespawnRules =	AutoSpawn:No	Cost:2250	Time:120000	Health:100%	; DEFAULT VALUES
		End

	EvaEventDieOwner 			= NazgulDie					; Eva event to trigger on unit's death. NOTICE THAT this is only for permanent deaths

	;---------DISMOUNT------------------------------------------------------------------------
 	Behavior = SpecialPowerModule ModuleTag_MorgomirDismountStarter
 		SpecialPowerTemplate		= SpecialAbilityToggleMountedFromFellBeast
 		UpdateModuleStartsAttack	= Yes
 		StartsPaused			= No
		InitiateSound			= FellBeastVoiceMove
 	End
	Behavior = ToggleMountedSpecialAbilityUpdate ModuleTag_MorgomirDismount
 		SpecialPowerTemplate    	= SpecialAbilityToggleMountedFromFellBeast
 		StartAbilityRange		= 50.0						; pretty small so we are forced to the right place.
 		MountedTemplate			= MordorMorgromirMounted
 		SynchronizeTimerOnSpecialPower 	= SpecialAbilityBlackRiderMorgulBlade SpecialAbilityScreech
 		UnpackTime              	= 0
 		PreparationTime         	= 1  
; 		PersistentPrepTime      	= 250
 		PackTime               	 	= 0
 		OpacityTarget			= 1						; How see-thru to be at peak of change
 		AwardXPForTriggering    	= 0
 		IgnoreFacingCheck		= Yes
	End

	Behavior = AISpecialPowerUpdate ToggleMountedAI
		CommandButtonName = Command_KhamulToggleMounted
		SpecialPowerAIType = AI_SPECIAL_POWER_TOGGLE_MOUNTED
	End
 	;--------- MORGUL BLADE -----------------------------------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_BlackRiderMorgulBlade
		SpecialPowerTemplate = SpecialAbilityBlackRiderMorgulBlade
		TriggeredBy = Upgrade_BlackRiderMorgulBlade
	End
	Behavior = SpecialPowerModule ModuleTag_BlackRiderMorgulBladeStarter
		SpecialPowerTemplate		= SpecialAbilityBlackRiderMorgulBlade
		UpdateModuleStartsAttack	= Yes
		StartsPaused				= Yes
		InitiateSound				= FellBeastVoiceAttack		;LurtzVoiceAttackCripplingStrike
	End
	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_BlackRiderMorgulBladeUpdate
		SpecialPowerTemplate    = SpecialAbilityBlackRiderMorgulBlade
		SkipContinue			= Yes

		UnpackTime				= 250
		PreparationTime			= 1
		PersistentPrepTime		= 500
		PackTime				= 100
		
		AwardXPForTriggering	= 0		
		StartAbilityRange		= 15.0
		
		SpecialWeapon			= EvilMenBlackRiderMorgulBlade
		WhichSpecialWeapon		= 1
	End
	Behavior = AutoAbilityBehavior ModuleTag_MorgulBladeAutoAbility
		SpecialAbility	= SpecialAbilityBlackRiderMorgulBlade
		ForbiddenStatus = INSIDE_GARRISON
		AllowSelf		= No
		Query			= 1 MORGULBLADE_OBJECT_FILTER
	End
	
	Behavior = NotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
	End

	; Generic auto ability.
	Behavior = AutoAbilityBehavior ModuleTag_AutoAbilityBehavior
	End

	;-----WING BLAST---------------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_WingBlastUnpause
		SpecialPowerTemplate		= SpecialAbilityMorgulWing
		TriggeredBy					= Upgrade_ObjectLevel3
	End

	Behavior = SpecialPowerModule ModuleTag_WingBlastStarter
		SpecialPowerTemplate		= SpecialAbilityMorgulWing
		UpdateModuleStartsAttack	= Yes
		StartsPaused			= Yes
		InitiateSound			= DrogothVoxWingBlast
	End

	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_WingBlastUpdate
		SpecialPowerTemplate    = SpecialAbilityMorgulWing
		UnpackTime              = 2000												; time before the first flap
		PreparationTime			= 1													; *needs* to be something non-zero
		PackTime                = 1000
		PersistentPrepTime		= 900												; time between flaps, can't get much of a lower value than this.
		PersistentCount			= 20	; Total timing: this * PersistentPrepTime			; Change the anim speed to get a better match.
		AwardXPForTriggering    = 0
		StartAbilityRange		= 1.0	;please don't make this zero
										;zero makes the AI that controls this power sad
		SpecialWeapon			= MorgulWingBlast
		WhichSpecialWeapon		= 3						; sets SPECIAL_WEAPON_THREE
		;SkipContinue			= Yes
	End	

	;--------- DREAD VISAGE -----------------------------------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_BlackRiderDreadVisage
		SpecialPowerTemplate = SpecialAbilityFakeLeadership
		TriggeredBy = Upgrade_BlackRiderDreadVisage
	End
	Behavior = SpecialPowerModule ModuleTag_BlackRiderDreadVisageUpdate
		SpecialPowerTemplate      = SpecialAbilityFakeLeadership
		UpdateModuleStartsAttack  = Yes
		StartsPaused = Yes
	End
	Behavior = AttributeModifierAuraUpdate ModuleTag_DreadVisage
		StartsActive		= No ;If no, requires upgrade to turn on.
		BonusName		= GenericDebuff
		TriggeredBy		= Upgrade_BlackRiderDreadVisage
		RefreshDelay	= 2000
		Range			= 200
		TargetEnemy		= Yes
		AntiCategory	= LEADERSHIP BUFF ; This means cancel all previous leadership bonuses
		ObjectFilter	= ANY +INFANTRY +CAVALRY -STRUCTURE -BASE_FOUNDATION -HERO -HORDE
	End
	Behavior = ModelConditionUpgrade ModuleTag_DreadVisageModelCondition
		TriggeredBy			= Upgrade_BlackRiderDreadVisage
		AddConditionFlags	= USER_3
	End
	
	Behavior = RadiateFearUpdate ModuleTag_DreadVisageFear
		InitiallyActive						= No
		TriggeredBy							= Upgrade_BlackRiderDreadVisage
		WhichSpecialPower					= 1
		GenerateTerror						= No
		GenerateFear			= Yes
		EmotionPulseRadius					= 100
		EmotionPulseInterval				= 1000
	End
	;--------- SCREECH -----------------------------------------------------------------------------------
 	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_BlackRiderScreechEnabler
		SpecialPowerTemplate = SpecialAbilityScreech
		TriggeredBy = Upgrade_BlackRiderNazgulScreech
	End
	Behavior = SpecialPowerModule ModuleTag_BlackRiderScreech                      
		SpecialPowerTemplate		= SpecialAbilityScreech
		UpdateModuleStartsAttack	= Yes
		StartsPaused			= Yes
		TriggerFX				= FX_FearBlast
	End
	Behavior = SpecialAbilityUpdate ModuleTag_BlackRiderScreechSAUpdate  
		SpecialPowerTemplate		= SpecialAbilityScreech
		UnpackTime					= 0  
		AwardXPForTriggering		= 0		
		TriggerSound				= NazgulScreech
		Instant						= Yes
		EffectRange					= 180
	End
End

;--------------------------------------------------------------------
; OBSOLETE
ChildObject MordorAgandaurOnFellBeast MordorFellBeastInterface		;Real witchking

	Scale = 1.2	

	ButtonImage			= HIAgandaur
    ; SelectPortrait for Heros is portrait behind skill buttons. HP = HeroPortrait.
	SelectPortrait = HPAgandaur
	
	DisplayName			= OBJECT:MordorAgandaur
  	Description         		= OBJECT:MordorAgandaurDescription
	RecruitText		= CONTROLBAR:MordorAgandaurRecruit
	ReviveText		= CONTROLBAR:MordorAgandaurRevive
	Hotkey			= CONTROLBAR:MordorAgandaurHotkey
    
    ; ButtonImage for Heros is button image on Hero Select UI to select hero. HI = HeroIcon or HeroImage.
    
        
    CommandSet			= AgandaurFellBeastCommandSet
	BuildCost			= WITCHKING_ON_FELLBEAST_BUILDCOST		
	BuildTime			= WITCHKING_ON_FELLBEAST_BUILDTIME		
	CommandPoints		= WITCHKING_COMMAND_POINTS

	;--- AUDIO Parameters ---

	SoundMoveStart		= NoSound

	;-------	

	Body = RespawnBody ModuleTag_02
		CheerRadius 	  = EMOTION_CHEER_RADIUS
		MaxHealth         = 5000			
		HealingBuffFx     = None
		DodgePercent     		= HERO_DODGE_PERCENT
	End

	Behavior = RespawnUpdate ModuleTag_RespawnUpdate
		DeathAnim					= DYING
		DeathFX						= FX_WitchKingDieToRespawn	;FXList to play when killed-to-respawn
		;DeathAnimationTime			= 5500 ;1133				;How long DeathAnim will take.
		InitialSpawnFX				= FX_WitchKingInitialSpawn
		RespawnFX					= FX_WitchKingRespawn		;FXList to play when respawning.
		;RespawnAnim				= LEVELED					;Animation to play when respawning.
		;RespawnAnimationTime		= 2000						;Time it takes for respawn to play.
		AutoRespawnAtObjectFilter	= NONE +CASTLE_KEEP			;Respawn at this location -- and at it's exit production point if possible.
		ButtonImage					= HIWitchKing_res
		RespawnAsTemplate			= MordorAgandaur
		
		;RespawnEntries determine the ruleset for how a character can be revived. Some units may automatically respawn, others
		;may require a specific revive action performed on him. You can specify different values for each level... or use Level:Any
		RespawnRules =	AutoSpawn:No	Cost:3750	Time:120000	Health:100%		;DEFAULT VALUES
		End

	;EvaEventDieOwner 			= WitchKingDie		;Eva event to trigger on unit's death. NOTICE THAT this is only for permanent deaths

	Behavior = TransportContain TransportContainModuleTag
		
		;Victim passenger
		ObjectStatusOfContained = UNSELECTABLE UNATTACKABLE
		PassengerFilter = ANY +INFANTRY +HULK +CAVALRY +GRAB_AND_DROP -HERO -PORTER
		Slots = 1
	
		;Standard TransportContain stuff
		ShowPips = No
		CollidePickup = No
		AllowEnemiesInside = Yes
		AllowNeutralInside = Yes
		AllowAlliesInside  = Yes
		DamagePercentToUnits = 0%
		PassengerBonePrefix = PassengerBone:B_PASSENGER       KindOf:GRAB_AND_DROP
		EjectPassengersOnDeath = No
		
		GrabWeapon = FellbeastGrabWeapon ; fire this weapon when fellbeast grabs a victim
		FireGrabWeaponOnVictim = No
	End
	
	;---------DISMOUNT------------------------------------------------------------------------
 	Behavior = SpecialPowerModule ModuleTag_DismountStarter
 		SpecialPowerTemplate		= SpecialAbilityToggleMountedFromFellBeast
 		UpdateModuleStartsAttack	= Yes
 		StartsPaused				= No
		InitiateSound				= FellBeastVoiceMove
 	End
	Behavior = ToggleMountedSpecialAbilityUpdate ModuleTag_Dismount
 		SpecialPowerTemplate    = SpecialAbilityToggleMountedFromFellBeast
 		StartAbilityRange		= 50.0									; pretty small so we are forced to the right place.
 		MountedTemplate			= MordorAgandaur                         
 		SynchronizeTimerOnSpecialPower = SpecialAbilityAgandaurBlink SpecialAbilityLightningStrike SpecialAbilityThunderclap SpecialAbilityAgandaurMorgulLightning 
 		UnpackTime              = 0
 		PreparationTime         = 1  
; 		PersistentPrepTime      = 250
 		PackTime                = 0
 		OpacityTarget			= 1										; How see-thru to be at peak of change
 		AwardXPForTriggering    = 0
 		IgnoreFacingCheck		= Yes
	End	

	;-----------------------------------------------------------------------------
	;	Leadership
	;-----------------------------------------------------------------------------	
	Behavior = AttributeModifierAuraUpdate ModuleTag_GoblinKingLeadershipUpdate
		StartsActive	= Yes ;No
		BonusName		= GenericHeroLeadership
		TriggeredBy		= Upgrade_ObjectLevel1
		RefreshDelay	= 2000
		Range			= 200
		AntiCategory	= BUFF
		ObjectFilter	= GENERIC_BUFF_RECIPIENT_OBJECT_FILTER 
	End	
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_GoblinKingLeadershipUnpause
		SpecialPowerTemplate = SpecialAbilityFakeLeadership
		TriggeredBy = Upgrade_ObjectLevel1
	End
	Behavior = SpecialPowerModule ModuleTag_GoblinKingLeadershipPower
		SpecialPowerTemplate      = SpecialAbilityFakeLeadership
		UpdateModuleStartsAttack  = No
		StartsPaused = Yes
	End

	;-----WING BLAST---------------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_WingBlastUnpause
		SpecialPowerTemplate		= SpecialAbilityMorgulWing
		ObeyRechageOnTrigger		= Yes
		TriggeredBy					= Upgrade_ObjectLevel3
	End

	Behavior = SpecialPowerModule ModuleTag_WingBlastStarter
		SpecialPowerTemplate		= SpecialAbilityMorgulWing
		UpdateModuleStartsAttack	= Yes
		StartsPaused			= Yes
		InitiateSound			= DrogothVoxWingBlast
	End

	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_WingBlastUpdate
		SpecialPowerTemplate    = SpecialAbilityMorgulWing
		UnpackTime              = 2000												; time before the first flap
		PreparationTime			= 1													; *needs* to be something non-zero
		PackTime                = 1000
		PersistentPrepTime		= 900												; time between flaps, can't get much of a lower value than this.
		PersistentCount			= 20	; Total timing: this * PersistentPrepTime			; Change the anim speed to get a better match.
		AwardXPForTriggering    = 0
		StartAbilityRange		= 1.0	;please don't make this zero
										;zero makes the AI that controls this power sad
		SpecialWeapon			= MorgulWingBlast
		WhichSpecialWeapon		= 3						; sets SPECIAL_WEAPON_THREE
		;SkipContinue			= Yes
	End
	
	;---------DREAD VISAGE------------------------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_DreadVisage
		SpecialPowerTemplate		= SpecialAbilityFakeLeadership
		TriggeredBy					= Upgrade_DreadVisage
	End
	Behavior = SpecialPowerModule ModuleTag_DreadVisageUpdate
		SpecialPowerTemplate		= SpecialAbilityFakeLeadership
		UpdateModuleStartsAttack	= Yes
		StartsPaused				= Yes
	End
	Behavior = AttributeModifierAuraUpdate ModuleTag_DreadVisageAura
		StartsActive	= No														;If no, requires upgrade to turn on.
		TriggeredBy		= Upgrade_DreadVisage
		RefreshDelay	= 2000
		Range			= WITCHKING_DREADVISAGE_EFFECT_RADIUS_MOUNTED
		TargetEnemy		= Yes
		AntiCategory	= LEADERSHIP BUFF
		BonusName		= GenericDebuff
		ObjectFilter	= ANY +INFANTRY +CAVALRY -STRUCTURE -BASE_FOUNDATION  -HERO -HORDE
	End
	Behavior = RadiateFearUpdate ModuleTag_DreadVisageFear
		InitiallyActive						= No
		TriggeredBy							= Upgrade_DreadVisage
		WhichSpecialPower					= 1
		GenerateFear						= Yes
		EmotionPulseRadius					= WITCHKING_DREADVISAGE_EFFECT_RADIUS_MOUNTED
		EmotionPulseInterval				= 2000
	End

	;------------------------LIGHTNING STORM-------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_LightningEnabler
		SpecialPowerTemplate	= SpecialAbilityLightningStrike
		ObeyRechageOnTrigger	= Yes
		TriggeredBy				= Upgrade_ObjectLevel5
	End

	Behavior = SpecialPowerModule ModuleTag_LightningStrike                      
		SpecialPowerTemplate		= SpecialAbilityLightningStrike
		UpdateModuleStartsAttack	= Yes
		StartsPaused				= Yes
		InitiateSound				= WizardTowerLightningStrikeRumbleMS
	End

	Behavior = ArrowStormUpdate ModuleTag_ShootLightningBolts
		SpecialPowerTemplate    = SpecialAbilityLightningStrike
		StartAbilityRange       = ISENGARD_WIZARDSTOWER_LIGHTNING_RANGE
		CanShootEmptyGround		= Yes
		UnpackingVariation		   = 2
		
		UnpackTime              = 2500	;// Pull out arrow
		PreparationTime         = 1		;// Quick shot
		PersistentPrepTime      = 500	;// looping the quick shot
		PackTime                = 1500	;// back to idle

		ApproachRequiresLOS     = No	;// required so that it doesn't shoot through walls
		AwardXPForTriggering    = 0
		
		;ActiveLoopSound			= GandalfLightningLoop  ;// Sound loops entire time ability is actively firing

		;//Specific to ArrowStorm
		WeaponTemplate  = AgandaurStormWeapon
		TargetRadius    = ISENGARD_WIZARDSTOWER_LIGHTNING_FIRE_RADIUS
		ShotsPerTarget  = 1
		ShotsPerBurst   = 1
		MaxShots        = ISENGARD_WIZARDSTOWER_LIGHTNING_NUMSHOTS  ;// will double up if run out of targets    
      End

	;---------------------------- MORGUL LIGHTNING-----------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_IstariLightEnabler
		SpecialPowerTemplate = SpecialAbilityAgandaurMorgulLightning
		ObeyRechageOnTrigger	= Yes
		TriggeredBy = Upgrade_ObjectLevel8
	End
	Behavior = SpecialPowerModule ModuleTag_IstariLightPower                      
		SpecialPowerTemplate		= SpecialAbilityAgandaurMorgulLightning 
		UpdateModuleStartsAttack	= Yes
		StartsPaused				= Yes
		InitiateSound				= SarumanVoiceAttackCharge
	End

	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_IstariLightUpdate
		SpecialPowerTemplate    = SpecialAbilityAgandaurMorgulLightning 
		SkipContinue			= Yes
		UnpackTime              = 700
 		PreparationTime         = 0  
 		PersistentPrepTime      = 800
 		PackTime                = 500
		AwardXPForTriggering    = 0
		StartAbilityRange		= 290; Note: This has to be smaller than the weapon range or it'll never succeed
		ApproachRequiresLOS		= Yes		
		SpecialWeapon			= AgandaurMorgulLightning
		MustFinishAbility		= Yes
		BusyForDuration			= 2500
		WhichSpecialWeapon		= 3
	End
	Behavior = ModelConditionUpgrade ModuleTag_MakeUsAWitchKing
		TriggeredBy			= Upgrade_MordorFaction
		AddConditionFlags	= RIDER3
		Permanent			= Yes
	End

	Behavior = ModelConditionUpgrade ModuleTag_MakeUsAWitchKing
		TriggeredBy			= Upgrade_WildFaction
		AddConditionFlags	= RIDER3
		Permanent			= Yes
	End


	;///////////////////
	; AISpecialPowers
	;///////////////////
	
	Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
		CommandButtonName = Command_SetStanceBattle
		SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
	End

	Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
		CommandButtonName = Command_SetStanceAggressive
		SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
	End

	Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
		CommandButtonName = Command_SetStanceHoldGround
		SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
	End

	
	Behavior = AISpecialPowerUpdate ToggleMountedAI
		CommandButtonName = Command_WitchKingToggleMounted
		SpecialPowerAIType = AI_SPECIAL_POWER_TOGGLE_MOUNTED
	End
	
	Behavior = AISpecialPowerUpdate ScreechAI
		CommandButtonName = Command_SpecialAbilityScreechWitchKing
		SpecialPowerAIType = AI_SPECIAL_POWER_BASIC_SELF_BUFF
	End
	
	Behavior = AISpecialPowerUpdate HourOfTheWitchKingAI
		CommandButtonName = Command_HourOfTheWitchKing
		SpecialPowerAIType = AI_SPECIAL_POWER_ENEMY_TYPE_KILLER
	End	
End

ChildObject WildAgandaurOnFellBeast MordorAgandaurOnFellBeast 

	DisplayName			= OBJECT:WildAgandaur
  	Description         		= OBJECT:WildAgandaurDescription
	RecruitText		= CONTROLBAR:WildAgandaurRecruit
	ReviveText		= CONTROLBAR:WildAgandaurRevive
	Hotkey			= CONTROLBAR:WildAgandaurHotkey
	;---------DISMOUNT------------------------------------------------------------------------
 	Behavior = SpecialPowerModule ModuleTag_DismountStarter
 		SpecialPowerTemplate		= SpecialAbilityToggleMountedFromFellBeast
 		UpdateModuleStartsAttack	= Yes
 		StartsPaused				= No
		InitiateSound				= FellBeastVoiceMove
 	End
	Behavior = ToggleMountedSpecialAbilityUpdate ModuleTag_Dismount
 		SpecialPowerTemplate    = SpecialAbilityToggleMountedFromFellBeast
 		StartAbilityRange		= 50.0									; pretty small so we are forced to the right place.
 		MountedTemplate			= WildAgandaur                         
 		SynchronizeTimerOnSpecialPower = SpecialAbilityAgandaurBlink SpecialAbilityLightningStrike SpecialAbilityThunderclap SpecialAbilityAgandaurMorgulLightning 
 		UnpackTime              = 0
 		PreparationTime         = 1  
; 		PersistentPrepTime      = 250
 		PackTime                = 0
 		OpacityTarget			= 1										; How see-thru to be at peak of change
 		AwardXPForTriggering    = 0
 		IgnoreFacingCheck		= Yes
	End
End

;--------------------------------------------------------------------

ChildObject NazgulFellBeastInterface MordorFellBeastInterface

	Scale = 1.2

	DisplayName		= OBJECT:MordorNazgul
	DisplayNameStrategic		= OBJECT:MordorNazgul
	RecruitText		= CONTROLBAR:MordorNazgulRecruit
	ReviveText		= CONTROLBAR:MordorNazgulRevive
	Hotkey			= CONTROLBAR:MordorNazgulHotkey

	CommandSet		= NazgulFellBeastCommandSet					; CommandSet is overridden by Behavior Rider changes.

 	;--------- SCREECH -----------------------------------------------------------------------------------
 	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_BlackRiderScreechEnabler
		SpecialPowerTemplate = SpecialAbilityScreech
		TriggeredBy = Upgrade_BlackRiderNazgulScreech
	End
	Behavior = SpecialPowerModule ModuleTag_BlackRiderScreech                      
		SpecialPowerTemplate		= SpecialAbilityScreech
		UpdateModuleStartsAttack	= Yes
		StartsPaused			= Yes
		TriggerFX				= FX_FearBlast
	End
	Behavior = SpecialAbilityUpdate ModuleTag_BlackRiderScreechSAUpdate  
		SpecialPowerTemplate		= SpecialAbilityScreech
		UnpackTime					= 0  
		AwardXPForTriggering		= 0		
		TriggerSound				= NazgulScreech
		Instant						= Yes
		EffectRange					= 180
	End	

	Body = RespawnBody ModuleTag_02
		CheerRadius 	  = EMOTION_CHEER_RADIUS
		MaxHealth         = NAZGUL_HEALTH		
		HealingBuffFx     = None
	End

	Behavior = RespawnUpdate ModuleTag_RespawnUpdate
		DeathAnim			= DYING
		DeathFX				= FX_NazgulOnFellbeastDieToRespawn		; FXList to play when killed-to-respawn
		;DeathAnimationTime		= 5500 		;1133				; How long DeathAnim will take.
		InitialSpawnFX			= FX_NazgulInitialSpawn
		RespawnFX			= FX_NazgulRespawn				; FXList to play when respawning.
		;RespawnAnim			= LEVELED					; Animation to play when respawning.
		;RespawnAnimationTime		= 2000						; Time it takes for respawn to play.
		AutoRespawnAtObjectFilter	= NONE +CASTLE_KEEP				; Respawn at this location -- and at it's exit production point if possible.
		ButtonImage			= HINazgul_res
		
		;RespawnEntries determine the ruleset for how a character can be revived. Some units may automatically respawn, others
		;may require a specific revive action performed on him. You can specify different values for each level... or use Level:Any
		RespawnRules =	AutoSpawn:No	Cost:2250	Time:120000	Health:100%	; DEFAULT VALUES
		End

	EvaEventDieOwner 			= NazgulDie					; Eva event to trigger on unit's death. NOTICE THAT this is only for permanent deaths

	;---------DISMOUNT------------------------------------------------------------------------
 	Behavior = SpecialPowerModule ModuleTag_MorgomirDismountStarter
 		SpecialPowerTemplate		= SpecialAbilityToggleMountedFromFellBeast
 		UpdateModuleStartsAttack	= Yes
 		StartsPaused			= No
		InitiateSound			= FellBeastVoiceMove
 	End
	Behavior = ToggleMountedSpecialAbilityUpdate ModuleTag_MorgomirDismount
 		SpecialPowerTemplate    	= SpecialAbilityToggleMountedFromFellBeast
 		StartAbilityRange		= 50.0						; pretty small so we are forced to the right place.
 		MountedTemplate			= MordorMorgromirMounted
 		SynchronizeTimerOnSpecialPower 	= SpecialAbilityBlackRiderMorgulBlade SpecialAbilityScreech
 		UnpackTime              	= 0
 		PreparationTime         	= 1  
; 		PersistentPrepTime      	= 250
 		PackTime               	 	= 0
 		OpacityTarget			= 1						; How see-thru to be at peak of change
 		AwardXPForTriggering    	= 0
 		IgnoreFacingCheck		= Yes
	End

	Behavior = AISpecialPowerUpdate ToggleMountedAI
		CommandButtonName = Command_KhamulToggleMounted
		SpecialPowerAIType = AI_SPECIAL_POWER_TOGGLE_MOUNTED
	End
 	;--------- MORGUL BLADE -----------------------------------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_BlackRiderMorgulBlade
		SpecialPowerTemplate = SpecialAbilityBlackRiderMorgulBlade
		TriggeredBy = Upgrade_BlackRiderMorgulBlade
	End
	Behavior = SpecialPowerModule ModuleTag_BlackRiderMorgulBladeStarter
		SpecialPowerTemplate		= SpecialAbilityBlackRiderMorgulBlade
		UpdateModuleStartsAttack	= Yes
		StartsPaused				= Yes
		InitiateSound				= FellBeastVoiceAttack		;LurtzVoiceAttackCripplingStrike
	End
	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_BlackRiderMorgulBladeUpdate
		SpecialPowerTemplate    = SpecialAbilityBlackRiderMorgulBlade
		SkipContinue			= Yes

		UnpackTime				= 250
		PreparationTime			= 1
		PersistentPrepTime		= 500
		PackTime				= 100
		
		AwardXPForTriggering	= 0		
		StartAbilityRange		= 15.0
		
		SpecialWeapon			= EvilMenBlackRiderMorgulBlade
		WhichSpecialWeapon		= 1
	End
	Behavior = AutoAbilityBehavior ModuleTag_MorgulBladeAutoAbility
		SpecialAbility	= SpecialAbilityBlackRiderMorgulBlade
		ForbiddenStatus = INSIDE_GARRISON
		AllowSelf		= No
		Query			= 1 ANY ENEMIES +HERO
		Query			= 1 MORGULBLADE_OBJECT_FILTER
	End
	
	Behavior = NotifyTargetsOfImminentProbableCrushingUpdate ModuleTag_NotifyCrushScan
	End

	; Generic auto ability.
	Behavior = AutoAbilityBehavior ModuleTag_AutoAbilityBehavior
	End	
;--------- DREAD VISAGE -----------------------------------------------------------------------------------
	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_BlackRiderDreadVisage
		SpecialPowerTemplate = SpecialAbilityFakeLeadership
		TriggeredBy = Upgrade_BlackRiderDreadVisage
	End
	Behavior = SpecialPowerModule ModuleTag_BlackRiderDreadVisageUpdate
		SpecialPowerTemplate      = SpecialAbilityFakeLeadership
		UpdateModuleStartsAttack  = Yes
		StartsPaused = Yes
	End
	Behavior = AttributeModifierAuraUpdate ModuleTag_DreadVisage
		StartsActive		= No ;If no, requires upgrade to turn on.
		BonusName		= GenericDebuff
		TriggeredBy		= Upgrade_BlackRiderDreadVisage
		RefreshDelay	= 2000
		Range			= 200
		TargetEnemy		= Yes
		AntiCategory	= LEADERSHIP BUFF ; This means cancel all previous leadership bonuses
		ObjectFilter	= ANY +INFANTRY +CAVALRY -STRUCTURE -BASE_FOUNDATION -HERO -HORDE
	End
	Behavior = ModelConditionUpgrade ModuleTag_DreadVisageModelCondition
		TriggeredBy			= Upgrade_BlackRiderDreadVisage
		AddConditionFlags	= USER_3
	End
	
	Behavior = RadiateFearUpdate ModuleTag_DreadVisageFear
		InitiallyActive						= No
		TriggeredBy							= Upgrade_BlackRiderDreadVisage
		WhichSpecialPower					= 1
		GenerateTerror						= No
		GenerateFear			= Yes
		EmotionPulseRadius					= 100
		EmotionPulseInterval				= 1000
	End

	;--------- SCREECH -----------------------------------------------------------------------------------
 	Behavior = UnpauseSpecialPowerUpgrade ModuleTag_BlackRiderScreechEnabler
		SpecialPowerTemplate = SpecialAbilityScreech
		TriggeredBy = Upgrade_BlackRiderNazgulScreech
	End
	Behavior = SpecialPowerModule ModuleTag_BlackRiderScreech                      
		SpecialPowerTemplate		= SpecialAbilityScreech
		UpdateModuleStartsAttack	= Yes
		StartsPaused			= Yes
		TriggerFX				= FX_FearBlast
	End
	Behavior = SpecialAbilityUpdate ModuleTag_BlackRiderScreechSAUpdate  
		SpecialPowerTemplate		= SpecialAbilityScreech
		UnpackTime					= 0  
		AwardXPForTriggering		= 0		
		TriggerSound				= NazgulScreech
		Instant						= Yes
		EffectRange					= 180
	End
End
;--------------------------------------------------------------------

ChildObject NazgulFellBeast1 NazgulFellBeastInterface 
	;---------DISMOUNT------------------------------------------------------------------------
 	Behavior = SpecialPowerModule ModuleTag_MorgomirDismountStarter
 		SpecialPowerTemplate		= SpecialAbilityToggleMountedFromFellBeast
 		UpdateModuleStartsAttack	= Yes
 		StartsPaused			= No
		InitiateSound			= FellBeastVoiceMove
 	End
	Behavior = ToggleMountedSpecialAbilityUpdate ModuleTag_MorgomirDismount
 		SpecialPowerTemplate    	= SpecialAbilityToggleMountedFromFellBeast
 		StartAbilityRange		= 50.0						; pretty small so we are forced to the right place.
 		MountedTemplate			= MordorNazgul1
 		SynchronizeTimerOnSpecialPower 	= SpecialAbilityBlackRiderMorgulBlade SpecialAbilityScreech
 		UnpackTime              	= 0
 		PreparationTime         	= 1  
; 		PersistentPrepTime      	= 250
 		PackTime               	 	= 0
 		OpacityTarget			= 1						; How see-thru to be at peak of change
 		AwardXPForTriggering    	= 0
 		IgnoreFacingCheck		= Yes
	End

	Behavior = AISpecialPowerUpdate ToggleMountedAI
		CommandButtonName = Command_NazgulToggleMounted
		SpecialPowerAIType = AI_SPECIAL_POWER_TOGGLE_MOUNTED
	End
End
;--------------------------------------------------------------------

ChildObject NazgulFellBeast2 NazgulFellBeastInterface 
	;---------DISMOUNT------------------------------------------------------------------------
 	Behavior = SpecialPowerModule ModuleTag_MorgomirDismountStarter
 		SpecialPowerTemplate		= SpecialAbilityToggleMountedFromFellBeast
 		UpdateModuleStartsAttack	= Yes
 		StartsPaused			= No
		InitiateSound			= FellBeastVoiceMove
 	End
	Behavior = ToggleMountedSpecialAbilityUpdate ModuleTag_MorgomirDismount
 		SpecialPowerTemplate    	= SpecialAbilityToggleMountedFromFellBeast
 		StartAbilityRange		= 50.0						; pretty small so we are forced to the right place.
 		MountedTemplate			= MordorNazgul2
 		SynchronizeTimerOnSpecialPower 	= SpecialAbilityBlackRiderMorgulBlade SpecialAbilityScreech
 		UnpackTime              	= 0
 		PreparationTime         	= 1  
; 		PersistentPrepTime      	= 250
 		PackTime               	 	= 0
 		OpacityTarget			= 1						; How see-thru to be at peak of change
 		AwardXPForTriggering    	= 0
 		IgnoreFacingCheck		= Yes
	End

	Behavior = AISpecialPowerUpdate ToggleMountedAI
		CommandButtonName = Command_NazgulToggleMounted
		SpecialPowerAIType = AI_SPECIAL_POWER_TOGGLE_MOUNTED
	End
End

;--------------------------------------------------------------------

ChildObject NazgulFellBeast3 NazgulFellBeastInterface 
	;---------DISMOUNT------------------------------------------------------------------------
 	Behavior = SpecialPowerModule ModuleTag_MorgomirDismountStarter
 		SpecialPowerTemplate		= SpecialAbilityToggleMountedFromFellBeast
 		UpdateModuleStartsAttack	= Yes
 		StartsPaused			= No
		InitiateSound			= FellBeastVoiceMove
 	End
	Behavior = ToggleMountedSpecialAbilityUpdate ModuleTag_MorgomirDismount
 		SpecialPowerTemplate    	= SpecialAbilityToggleMountedFromFellBeast
 		StartAbilityRange		= 50.0						; pretty small so we are forced to the right place.
 		MountedTemplate			= MordorNazgul3
 		SynchronizeTimerOnSpecialPower 	= SpecialAbilityBlackRiderMorgulBlade SpecialAbilityScreech
 		UnpackTime              	= 0
 		PreparationTime         	= 1  
; 		PersistentPrepTime      	= 250
 		PackTime               	 	= 0
 		OpacityTarget			= 1						; How see-thru to be at peak of change
 		AwardXPForTriggering    	= 0
 		IgnoreFacingCheck		= Yes
	End

	Behavior = AISpecialPowerUpdate ToggleMountedAI
		CommandButtonName = Command_NazgulToggleMounted
		SpecialPowerAIType = AI_SPECIAL_POWER_TOGGLE_MOUNTED
	End
End
;--------------------------------------------------------------------

ChildObject NazgulFellBeast4 NazgulFellBeastInterface 
	;---------DISMOUNT------------------------------------------------------------------------
 	Behavior = SpecialPowerModule ModuleTag_MorgomirDismountStarter
 		SpecialPowerTemplate		= SpecialAbilityToggleMountedFromFellBeast
 		UpdateModuleStartsAttack	= Yes
 		StartsPaused			= No
		InitiateSound			= FellBeastVoiceMove
 	End
	Behavior = ToggleMountedSpecialAbilityUpdate ModuleTag_MorgomirDismount
 		SpecialPowerTemplate    	= SpecialAbilityToggleMountedFromFellBeast
 		StartAbilityRange		= 50.0						; pretty small so we are forced to the right place.
 		MountedTemplate			= MordorNazgul4
 		SynchronizeTimerOnSpecialPower 	= SpecialAbilityBlackRiderMorgulBlade SpecialAbilityScreech
 		UnpackTime              	= 0
 		PreparationTime         	= 1  
; 		PersistentPrepTime      	= 250
 		PackTime               	 	= 0
 		OpacityTarget			= 1						; How see-thru to be at peak of change
 		AwardXPForTriggering    	= 0
 		IgnoreFacingCheck		= Yes
	End

	Behavior = AISpecialPowerUpdate ToggleMountedAI
		CommandButtonName = Command_NazgulToggleMounted
		SpecialPowerAIType = AI_SPECIAL_POWER_TOGGLE_MOUNTED
	End
End
;--------------------------------------------------------------------

ChildObject NazgulFellBeast5 NazgulFellBeastInterface 
	;---------DISMOUNT------------------------------------------------------------------------
 	Behavior = SpecialPowerModule ModuleTag_MorgomirDismountStarter
 		SpecialPowerTemplate		= SpecialAbilityToggleMountedFromFellBeast
 		UpdateModuleStartsAttack	= Yes
 		StartsPaused			= No
		InitiateSound			= FellBeastVoiceMove
 	End
	Behavior = ToggleMountedSpecialAbilityUpdate ModuleTag_MorgomirDismount
 		SpecialPowerTemplate    	= SpecialAbilityToggleMountedFromFellBeast
 		StartAbilityRange		= 50.0						; pretty small so we are forced to the right place.
 		MountedTemplate			= MordorNazgul5
 		SynchronizeTimerOnSpecialPower 	= SpecialAbilityBlackRiderMorgulBlade SpecialAbilityScreech
 		UnpackTime              	= 0
 		PreparationTime         	= 1  
; 		PersistentPrepTime      	= 250
 		PackTime               	 	= 0
 		OpacityTarget			= 1						; How see-thru to be at peak of change
 		AwardXPForTriggering    	= 0
 		IgnoreFacingCheck		= Yes
	End

	Behavior = AISpecialPowerUpdate ToggleMountedAI
		CommandButtonName = Command_NazgulToggleMounted
		SpecialPowerAIType = AI_SPECIAL_POWER_TOGGLE_MOUNTED
	End
End
;--------------------------------------------------------------------

ChildObject NazgulFellBeast6 NazgulFellBeastInterface 
	;---------DISMOUNT------------------------------------------------------------------------
 	Behavior = SpecialPowerModule ModuleTag_MorgomirDismountStarter
 		SpecialPowerTemplate		= SpecialAbilityToggleMountedFromFellBeast
 		UpdateModuleStartsAttack	= Yes
 		StartsPaused			= No
		InitiateSound			= FellBeastVoiceMove
 	End
	Behavior = ToggleMountedSpecialAbilityUpdate ModuleTag_MorgomirDismount
 		SpecialPowerTemplate    	= SpecialAbilityToggleMountedFromFellBeast
 		StartAbilityRange		= 50.0						; pretty small so we are forced to the right place.
 		MountedTemplate			= MordorNazgul6
 		SynchronizeTimerOnSpecialPower 	= SpecialAbilityBlackRiderMorgulBlade SpecialAbilityScreech
 		UnpackTime              	= 0
 		PreparationTime         	= 1  
; 		PersistentPrepTime      	= 250
 		PackTime               	 	= 0
 		OpacityTarget			= 1						; How see-thru to be at peak of change
 		AwardXPForTriggering    	= 0
 		IgnoreFacingCheck		= Yes
	End

	Behavior = AISpecialPowerUpdate ToggleMountedAI
		CommandButtonName = Command_NazgulToggleMounted
		SpecialPowerAIType = AI_SPECIAL_POWER_TOGGLE_MOUNTED
	End
End